(()=>{"use strict";class e{constructor(e,t,s,r=0){this.name=e,this.length=t,this.position=s,this.hits=r,this.hasSunken=!1}hit(e){this.position.splice(this.position.indexOf(e),1),this.hits++,this.isSunk(this.hits)}isSunk(){0===this.position.length&&(this.hasSunken=!0)}}const t=class{constructor(e){this.name=e,this.ships=[],this.board=new class{constructor(){this.boardPositionArray=[],this.hasShipArray=[],this.boardCreate()}boardCreate(){for(let e=0;e<100;e++)this.boardPositionArray.push(e)}receiveAttack(e){return this.boardPositionArray.includes(e)?(this.boardPositionArray.includes(e)&&this.boardPositionArray.splice(e,1),this.checkingIfHit(e)):"out of the box"}checkingIfHit(e){return!!this.hasShipArray.includes(e)&&(this.hasShipArray.splice(this.hasShipArray.indexOf(e),1),!0)}gameEnd(){return!(0!==this.hasShipArray.length)}shipsPlacement(e){const t=e.sort(((e,t)=>e-t)),s=[9,19,29,39,49,59,69,79,89,99],r=[90,91,92,93,94,95,96,97,98,99];for(let o=0;o<t.length-1;o++){if(e[o]<0)return!1;if(!this.boardPositionArray.includes(t[o]))return!1;if(this.hasShipArray.includes(e[o]))return!1;if(this.hasShipArray.includes(e[t.length-1]))return!1;if(t[o+1]-t[o]!=1&&t[o+1]-t[o]!=10)return!1;if(s.includes(t[o])||r.includes(t[o])){if(e.every((e=>s.includes(e)||r.includes(e))))break;if(o!==t.length||0!==o)return!1}}return this.hasShipArray.push(...t),!0}}}},s=new t("player"),r=new t("computer"),o=document.querySelector(".game-start");!function(){!function(){function e(e,t=10,s=10){e.style.setProperty("--grid-rows",t),e.style.setProperty("--grid-cols",s);for(let r=0;r<t*s;r++){const t=document.createElement("div");e.appendChild(t),t.classList.add("grid-item"),t.id=r}}const t=document.querySelector(".player-1"),s=document.querySelector(".player-2");e(t),e(s)}();const t=(e,s)=>{const r=Math.floor(100*Math.random()),o=[],i=[1,10,1,10,10,1,10,1],n=i[Math.floor(Math.random()*i.length)];for(let t=0;t<e;t++)o.push(r+t*n);return s.board.shipsPlacement(o)?o:t(e,s)},i=document.querySelector(".player-1"),n=document.querySelector(".player-2");n.classList.add("turn");const l=document.querySelector(".randomPlayer"),a=document.querySelector(".buttons");l.addEventListener("click",(()=>{(()=>{s.ships=[],s.board.hasShipArray=[];const r=document.querySelectorAll(".player-1 .grid-item");r.forEach((e=>{e.style.backgroundColor="rgb(17, 24, 39)"}));let o=5;for(let r=0;r<5;r++){const i=new e(`ship${r}`,o,t(o,s));s.ships.push(i),2!==o&&o--}for(let e=0;e<5;e++)0===e&&(s.board.hasShipArray=[]),s.board.shipsPlacement(s.ships[e].position);r.forEach((e=>{s.board.hasShipArray.includes(parseInt(e.id,10))&&(e.style.backgroundColor="green")}))})(),i.style.pointerEvents="none"})),o.addEventListener("click",(()=>16===s.board.hasShipArray.length&&(a.classList.add("hide"),i.style.pointerEvents="none",(()=>{document.querySelector(".player-1").classList.add("turn");let s=5;for(let o=0;o<5;o++){const i=new e(`ship${o}`,s,t(s,r));r.ships.push(i),2!==s&&s--}for(let e=0;e<5;e++)0===e&&(r.board.hasShipArray=[]),r.board.shipsPlacement(r.ships[e].position)})(),l.disabled=!0,o.disabled=!0,n.classList.remove("turn"),0)))}(),function(){const e=e=>{if(0===e.board.hasShipArray.length){const t=document.querySelector(".reset");t.style.pointerEvents="all";const s=document.querySelector(".win-display");return s.textContent=`${e.name} lost`,s.classList.add("show"),t.classList.add("show"),document.querySelector(".game").style.pointerEvents="none",!0}return!1},t=[],o=[],i=document.querySelector(".player-1"),n=document.querySelector(".player-2");let l,a=!1;document.querySelectorAll(".player-2 .grid-item").forEach((c=>{c.addEventListener("click",(()=>{const d=parseFloat(c.id);if(!t.includes(d)){t.push(d);const h=r.board.hasShipArray;if(h.includes(d)){if(c.style.backgroundColor="red",h.splice(h.indexOf(d),1),e(r))return 0}else c.style.backgroundColor="yellow";n.classList.add("turn"),i.classList.remove("turn"),setTimeout((()=>{(()=>{const t=s.board.boardPositionArray;let r=t[Math.floor(Math.random()*t.length)];if(a&&(r=((e,t)=>{for(let r=0;r<5;r++)if(s.ships[r].position.includes(e)){if(s.ships[r].hits===s.ships[r].length-1)return a=!1,t;console.log(s.ships[r].position);const o=s.ships[r].position;return s.ships[r].hit(e),console.log(s.ships[r].position),console.log(a),o[0]}})(l,r)),t.splice(t.indexOf(r),1),!o.includes(r)){l=r;const t=document.getElementById(`${r}`);o.push(r);const c=s.board.hasShipArray;if(c.includes(r)){if(a=!0,console.log(a),t.style.backgroundColor="red",c.splice(c.indexOf(r),1),e(s))return 0}else t.style.backgroundColor="yellow";i.classList.add("turn"),n.classList.remove("turn"),console.log(s)}})()}),1e3)}return 0}))}))}(),function(){const t=document.querySelector(".manual"),r=document.querySelector(".rotate");t.addEventListener("click",(()=>{r.classList.remove("hide"),function(){const t=document.querySelectorAll(".player-1 .grid-item"),r=document.querySelector(".rotate");let i=1;r.addEventListener("click",(()=>{i=1===i?10:1}));let n=5,l=0;t.forEach((r=>{r.addEventListener("click",(()=>{const a=[];for(let e=0;e<n;e++){const t=parseInt(r.id,10)+e*i;a.push(t)}if(!s.board.shipsPlacement(a))return!1;const c=new e(`ship-${l}`,n,a);return s.ships.push(c),t.forEach((e=>{e.style.backgroundColor=" ",e.style.border="1px solid red",s.board.hasShipArray.includes(parseInt(e.id,10))&&e.classList.add("green")})),l++,5===l&&o.click(),2===n?0:(n--,!0)})),r.addEventListener("mouseover",(()=>{for(let e=1;e<n;e++){const t=document.getElementById(`${parseInt(r.id,10)+e*i}`);if("green"===t.classList[1])return!1;t.style.border="2px solid green"}r.style.border="2px solid green"})),r.addEventListener("mouseleave",(()=>{for(let e=1;e<5;e++){const t=document.getElementById(`${parseInt(r.id,10)+e*i}`);if("green"===t.classList[1])return!1;t.style.border="1px solid red"}r.style.border="1px solid red"}))}))}()}))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SyxFQUFTM0QsVUFBVSxHQUFnQixPQUFPLEVBQzdDMkQsRUFBU2pFLE1BQU0rRCxPQUFTLGlCQUM1QixDQUNBcEMsRUFBSzNCLE1BQU0rRCxPQUFTLGlCQUFpQixJQUd6Q3BDLEVBQUtKLGlCQUFpQixjQUFjLEtBQ2hDLElBQUksSUFBSWhELEVBQUksRUFBR0EsRUFBSSxFQUFHQSxJQUFJLENBQ3RCLE1BQU0wRixFQUFXdkUsU0FBUzZELGVBQWUsR0FBR3pCLFNBQVNILEVBQUtuQixHQUFJLElBQUtqQyxFQUFFcUYsS0FDckUsR0FBNkIsVUFBMUJLLEVBQVMzRCxVQUFVLEdBQWdCLE9BQU8sRUFDN0MyRCxFQUFTakUsTUFBTStELE9BQVMsZUFDNUIsQ0FDQXBDLEVBQUszQixNQUFNK0QsT0FBUyxlQUFlLEdBQ3JDLEdBRVYsQ0RoRVEsRUFBaUIsR0FFekIsQ0ZIQUcsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9zaGlwUGxhY2VtZW50LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2hpdEdhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9nYW1lU3RhcnQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ3JlYXRpb24vbWFudWFsU2hpcHNQbGFjZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2hpcHN7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLGxlbmd0aCxwb3NpdGlvbiwgaGl0cyA9IDApe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMuaGl0cyA9IGhpdHM7XHJcbiAgICAgICAgdGhpcy5oYXNTdW5rZW4gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBoaXQocG9zaXRpb24pey8vIGhpdHMgdGhlIHBvc2l0aW9uIGFuZCByZW1vdmVzIHRoZSBwb3NpdGlvbiBmcm9tIHRoZSBhcnJheVxyXG4gICAgICAgIHRoaXMucG9zaXRpb24uc3BsaWNlKHRoaXMucG9zaXRpb24uaW5kZXhPZihwb3NpdGlvbiksMSk7XHJcbiAgICAgICAgdGhpcy5oaXRzKys7XHJcbiAgICAgICAgdGhpcy5pc1N1bmsodGhpcy5oaXRzKTtcclxuICAgIH1cclxuXHJcbiAgICBpc1N1bmsoKXsvLyBvbmNlIGFsbCBoaXQgaXQgc2lua3NcclxuICAgICAgICBpZih0aGlzLnBvc2l0aW9uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmhhc1N1bmtlbiA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSIsImNsYXNzIEdhbWVCb2FyZHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgIHRoaXMuYm9hcmRDcmVhdGUoKTsvLyBpbnN0YW50bHkgY3JlYXRlcyBhIGJvYXJkXHJcbiAgICB9XHJcblxyXG4gICAgYm9hcmRDcmVhdGUoKXtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2k8MTAwO2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlY2VpdmVBdHRhY2socG9zKXsvLyByZWNlaXZlcyBhdHRhY2sgYW5kIG1hcmtzIGlmIGhpdCBvciBtaXNzXHJcbiAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHBvcykpIHJldHVybiBcIm91dCBvZiB0aGUgYm94XCI7XHJcbiAgICAgICAgaWYodGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkuaW5jbHVkZXMocG9zKSl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnNwbGljZShwb3MsMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNraW5nSWZIaXQocG9zKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja2luZ0lmSGl0KHBvcyl7XHJcbiAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMocG9zKSl7Ly8gY2hlY2tpbmcgaGl0LCBpZiBoaXQgcmVtb3ZlcyBibG9jayBmcm9tIHNoaXBBcnJheVxyXG4gICAgICAgICAgICB0aGlzLmhhc1NoaXBBcnJheS5zcGxpY2UodGhpcy5oYXNTaGlwQXJyYXkuaW5kZXhPZihwb3MpLDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdhbWVFbmQoKXsvLyBjaGVjayBpZiBhbGwgc2hpcHMgc3Vua1xyXG4gICAgICAgIHJldHVybiAhISh0aGlzLmhhc1NoaXBBcnJheS5sZW5ndGggPT09IDApO1xyXG4gICAgfVxyXG5cclxuICAgIHNoaXBzUGxhY2VtZW50KHNoaXBzQXJyKXtcclxuICAgICAgICBjb25zdCBzaG9ydGVkU2hpcHNBcnIgPSBzaGlwc0Fyci5zb3J0KChhLCBiKSA9PmEgLSBiKTsvLyBzb3J0aW5nXHJcbiAgICAgICAgLy8gYm9yZGVyIG9mIHRoZSBib2FyZFxyXG4gICAgICAgIGNvbnN0IGJvcmRlckhvcml6b250YWwgPSBbOSwxOSwyOSwzOSw0OSw1OSw2OSw3OSw4OSw5OV07XHJcbiAgICAgICAgY29uc3QgYm9yZGVyVmVydGljYWwgPSBbOTAsOTEsOTIsOTMsOTQsOTUsOTYsOTcsOTgsOTldO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoLTE7aSsrKXtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGJleW9uZCBib2FyZFxyXG4gICAgICAgICAgICBpZihzaGlwc0FycltpXTwwKSByZXR1cm4gZmFsc2U7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxhcHBpbmcgb2Ygc2hpcHNcclxuICAgICAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMoc2hpcHNBcnJbaV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHNoaXBzQXJyW3Nob3J0ZWRTaGlwc0Fyci5sZW5ndGgtMV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHBsYWNlbWVudCBpbiByYW5kb20gb3JkZXJcclxuICAgICAgICAgICAgaWYoISgoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxIFxyXG4gICAgICAgICAgICB8fCAoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxMCkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGNyb3NzZXMgdGhlIHZlcnRpY2FsIGFuZCBob3Jpem9udG9sIGJvcmRlclxyXG4gICAgICAgICAgICBpZihib3JkZXJIb3Jpem9udGFsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkgXHJcbiAgICAgICAgICAgIHx8IGJvcmRlclZlcnRpY2FsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpe1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihzaGlwc0Fyci5ldmVyeShlbGVtID0+IGJvcmRlckhvcml6b250YWwuaW5jbHVkZXMoZWxlbSkgXHJcbiAgICAgICAgICAgICAgICB8fCBib3JkZXJWZXJ0aWNhbC5pbmNsdWRlcyhlbGVtKSkpIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgaWYoIShpID09PSBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoICYmIGkgPT09IDApKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkcyBzaGlwIHRvIGZyZXNoIGxvY2F0aW9uXHJcbiAgICAgICAgdGhpcy5oYXNTaGlwQXJyYXkucHVzaCguLi5zaG9ydGVkU2hpcHNBcnIpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBHYW1lQm9hcmQiLCJpbXBvcnQgR2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xyXG5cclxuY2xhc3MgUGxheWVye1xyXG4gICAgY29uc3RydWN0b3IobmFtZSl7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnNoaXBzID0gW107XHJcbiAgICAgICAgdGhpcy5ib2FyZCA9IG5ldyBHYW1lQm9hcmQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBsYXllciIsIi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnRpbnVlICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcbmltcG9ydCBQbGF5ZXIgZnJvbSBcIi4uL21vZHVsZXMvcGxheWVyXCJcclxuaW1wb3J0IFNoaXBzIGZyb20gXCIuLi9tb2R1bGVzL3NoaXBcIlxyXG5pbXBvcnQgZ2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xyXG5cclxuLy8gdHdvIG5ldyBwbGF5ZXJzIGNyZWF0ZWRcclxuY29uc3QgcGxheWVyID0gbmV3IFBsYXllcihcInBsYXllclwiKTtcclxuY29uc3QgY29tcHV0ZXIgPSBuZXcgUGxheWVyKFwiY29tcHV0ZXJcIik7XHJcbmNvbnN0IHN0YXJ0R2FtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZS1zdGFydFwiKTtcclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc2hpcHMoKXtcclxuICAgIGdhbWVCb2FyZCgpOy8vIGJveCBhcmVhIGZvciBib3RoIHBsYXllcnNcclxuXHJcbiAgICBjb25zdCBnZXRSYW5kb21MZWdhbFBvc2l0aW9uID0gKGosIHBlcnNvbik9PntcclxuICAgICAgICAvLyB3aGVuIHJhbmRvbWlzZWQgdGhlIHNoaXBzIHdpbGwgZ2V0IHBsYWNlZCBlaXRoZXIgdmVydGljYWwgb3IgaG9yaXpvbnRvbFxyXG4gICAgICAgIGNvbnN0IHJhbmRvbU51bWJlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCk7XHJcbiAgICAgICAgY29uc3QgbmV3QXJyYXkgPSBbXTtcclxuICAgICAgICBjb25zdCBhZGRpbmdBcnJheSA9IFsxLDEwLDEsMTAsMTAsMSwxMCwxXTtcclxuICAgICAgICBjb25zdCBhZGRpbmdEaWdpdCA9IGFkZGluZ0FycmF5W01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSphZGRpbmdBcnJheS5sZW5ndGgpXTtcclxuXHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgajtpKyspe1xyXG4gICAgICAgICAgICBuZXdBcnJheS5wdXNoKHJhbmRvbU51bWJlcisoaSAqIGFkZGluZ0RpZ2l0KSk7Ly8gYSByYW5kb20gbnVtYmVyIGFuZCBtYWtlIGEgc2VyaWFsaXNlZCBhcnJheSBvZiBpdFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihwZXJzb24uYm9hcmQuc2hpcHNQbGFjZW1lbnQobmV3QXJyYXkpKSByZXR1cm4gbmV3QXJyYXk7Ly8gaWYgcGxhY2VtZW50IGl0IGNvcnJlY3QgcmV0dXJuc1xyXG4gICAgICAgIHJldHVybiBnZXRSYW5kb21MZWdhbFBvc2l0aW9uKGosIHBlcnNvbik7Ly8gaWYgbm90IHJlY3Vyc2l2ZSBmdW5jdGlvblxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBsYXllclNoaXBzID0gKCk9PnsvLyBjcmVhdGVzIHNoaXBzIGZvciBwbGF5ZXIgYXQgcmFuZG9tIHBsYWNlc1xyXG4gICAgICAgIHBsYXllci5zaGlwcyA9IFtdO1xyXG4gICAgICAgIHBsYXllci5ib2FyZC5oYXNTaGlwQXJyYXkgPSBbXTtcclxuICAgICAgICBjb25zdCBncmlkSXRlbVBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTEgLmdyaWQtaXRlbVwiKTtcclxuICAgICAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+e1xyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmdiKDE3LCAyNCwgMzkpXCI7XHJcbiAgICAgICAgfSlcclxuICAgICAgICBsZXQgaiA9IDU7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgNTtpKyspe1xyXG4gICAgICAgICAgICBjb25zdCBwbGF5ZXJTaGlwID0gbmV3IFNoaXBzKGBzaGlwJHtpfWAsaiwgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBwbGF5ZXIpKTtcclxuICAgICAgICAgICAgcGxheWVyLnNoaXBzLnB1c2gocGxheWVyU2hpcCk7XHJcbiAgICAgICAgICAgIC8vIG5vIHNoaXBzIGxlc3MgdGhhbiAyIGluIHNpemVcclxuICAgICAgICAgICAgaWYoaiA9PT0gMikgY29udGludWU7XHJcbiAgICAgICAgICAgIGotLTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvcihsZXQgaSA9MDsgaTw1O2krKyl7XHJcbiAgICAgICAgICAgIGlmKGk9PT0wKSBwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5ID0gW107Ly8gY2xlYXJpbmcgdGhlIHNoaXAgYXJyYXlcclxuICAgICAgICAgICAgcGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KHBsYXllci5zaGlwc1tpXS5wb3NpdGlvbik7Ly8gZmlsbGluZyBpdCB3aXRoIHByb3BlciBwbGFjZW1lbnRzXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+ey8vIHNob3dpbmcgdGhlIHBsYXllcidzIHNoaXAgbG9jYXRpb25cclxuICAgICAgICBpZihwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHBhcnNlSW50KGdyaWQuaWQsIDEwKSkpe1xyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JlZW5cIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb21wdXRlclNoaXBzID0gKCk9PntcclxuICAgICAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgICAgIHBsYXllck9uZS5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTsgLy8gZGlzYmFsaW5nIERPTSBmb3Igb3Bwb3NpdGUgcGxheWVyXHJcbiAgICAgICAgbGV0IGogPSA1O1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDU7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgY29tcFNoaXAgPSBuZXcgU2hpcHMoYHNoaXAke2l9YCxqLCBnZXRSYW5kb21MZWdhbFBvc2l0aW9uKGosIGNvbXB1dGVyKSlcclxuICAgICAgICAgICAgY29tcHV0ZXIuc2hpcHMucHVzaChjb21wU2hpcCk7XHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IobGV0IGkgPTAgOyBpPDU7aSsrKXtcclxuICAgICAgICAgICAgaWYoaT09PTApIGNvbXB1dGVyLmJvYXJkLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBjb21wdXRlci5ib2FyZC5zaGlwc1BsYWNlbWVudChjb21wdXRlci5zaGlwc1tpXS5wb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTFcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0yXCIpO1xyXG4gICAgcGxheWVyVHdvLmNsYXNzTGlzdC5hZGQoXCJ0dXJuXCIpO1xyXG4gICAgLy8gY3JlYXRpbmcgc2hpcHMgcmFuZG9tbHkgZm9yIHVzZXJcclxuICAgIGNvbnN0IHJhbmRvbWlzZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmFuZG9tUGxheWVyXCIpO1xyXG4gICAgY29uc3QgYnV0dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1dHRvbnNcIik7XHJcbiAgICByYW5kb21pc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgcGxheWVyU2hpcHMoKTtcclxuICAgICAgICBwbGF5ZXJPbmUuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xyXG4gICAgfSlcclxuICAgIC8vIHN0YXJ0aW5nIHRoZSBnYW1lIGFmdGVyIHBsYWNlbWVudHNcclxuICAgIHN0YXJ0R2FtZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBpZihwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5Lmxlbmd0aCAhPT0gMTYpIHJldHVybiBmYWxzZTsvLyBjYW47dCBzdGFydCBnYW1lIHdpdGhvdXQgcGxhY2VtZW50IG9mIGFsbCBzaGlwc1xyXG4gICAgICAgIGJ1dHR0b25zLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xyXG4gICAgICAgIHBsYXllck9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XHJcbiAgICAgICAgY29tcHV0ZXJTaGlwcygpO1xyXG4gICAgICAgIC8vIGRpc2JhbGluZyBET00gYnV0dG9uc1xyXG4gICAgICAgIHJhbmRvbWlzZS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgc3RhcnRHYW1lLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBwbGF5ZXJPbmUgY2FuIGF0dGFja1xyXG4gICAgICAgIHBsYXllclR3by5jbGFzc0xpc3QucmVtb3ZlKFwidHVyblwiKTtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH0pXHJcbiAgICBcclxufVxyXG5cclxuZXhwb3J0IHtwbGF5ZXIsIGNvbXB1dGVyLCBzdGFydEdhbWV9IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2FtZUJvYXJkKCl7XHJcbiAgICBmdW5jdGlvbiBtYWtlUm93cyhkaXYscm93cyA9IDEwLCBjb2xzPTEwKSB7XHJcbiAgICAgICAgZGl2LnN0eWxlLnNldFByb3BlcnR5KFwiLS1ncmlkLXJvd3NcIiwgcm93cyk7XHJcbiAgICAgICAgZGl2LnN0eWxlLnNldFByb3BlcnR5KFwiLS1ncmlkLWNvbHNcIiwgY29scyk7XHJcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCAocm93cyAqIGNvbHMpOyBjKyspIHtcclxuICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGNlbGwpO1xyXG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgICAgY2VsbC5pZCA9IGM7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IHBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTFcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0yXCIpO1xyXG4gICAgLy8gY3JlYXRlcyAxMHgxMCBib3ggZm9yIGJvdGggcGxheWVyc1xyXG4gICAgbWFrZVJvd3MocGxheWVyT25lKTtcclxuICAgIG1ha2VSb3dzKHBsYXllclR3byk7XHJcbn0iLCJpbXBvcnQgZ2FtZVN0YXJ0IGZyb20gXCIuL2dhbWVDcmVhdGlvbi9nYW1lU3RhcnRcIjtcclxuaW1wb3J0IGhpdEJvYXJkIGZyb20gXCIuL2dhbWVDcmVhdGlvbi9oaXRHYW1lQm9hcmRcIjtcclxuaW1wb3J0IHNoaXBzICBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuc2hpcHMoKTtcclxuaGl0Qm9hcmQoKTtcclxuZ2FtZVN0YXJ0KCk7IiwiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L25vLWN5Y2xlICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcbmltcG9ydCB7IGNvbXB1dGVyLCBwbGF5ZXIgfSBmcm9tIFwiLi9zaGlwUGxhY2VtZW50XCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBoaXRCb2FyZCgpe1xyXG5cclxuICAgIGNvbnN0IGNoZWNrR2FtZUVuZCA9IChwZXJzb24pPT57XHJcbiAgICAgICAgaWYocGVyc29uLmJvYXJkLmhhc1NoaXBBcnJheS5sZW5ndGggPT09IDApe1xyXG4gICAgICAgICAgICBjb25zdCByZXNldEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmVzZXRcIik7XHJcbiAgICAgICAgICAgIHJlc2V0QnV0dG9uLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcImFsbFwiO1xyXG4gICAgICAgICAgICBjb25zdCB3aW5EaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi53aW4tZGlzcGxheVwiKTtcclxuICAgICAgICAgICAgd2luRGlzcGxheS50ZXh0Q29udGVudCA9IGAke3BlcnNvbi5uYW1lfSBsb3N0YDtcclxuICAgICAgICAgICAgd2luRGlzcGxheS5jbGFzc0xpc3QuYWRkKFwic2hvd1wiKVxyXG4gICAgICAgICAgICByZXNldEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwic2hvd1wiKTtcclxuICAgICAgICAgICAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZVwiKTtcclxuICAgICAgICAgICAgbWFpbi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7IC8vIGFmdGVyIGdhbWUgZW5kcyBET00gYWxsb3dlZFxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBhcnJheSBmb3IgcmVjb3JkaW5nIHNob3RzXHJcbiAgICBjb25zdCBzaG90c0FycmF5ID0gW107XHJcbiAgICBjb25zdCBzaG90c0FycmF5Q29tcCA9IFtdO1xyXG4gICAgY29uc3QgcGxheWVyT25lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMVwiKTtcclxuICAgIGNvbnN0IHBsYXllclR3byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTJcIik7XHJcbiAgICBsZXQgaGl0U2hpcCA9IGZhbHNlO1xyXG4gICAgbGV0IHByZXZwb3M7XHJcbiAgXHJcbiAgICBjb25zdCBzbWFydEhpdHRpbmdTaGlwcyA9IChwb3MsIG5ld1Bvcyk9PntcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCA1O2krKyl7XHJcbiAgICAgICAgICAgIGlmKHBsYXllci5zaGlwc1tpXS5wb3NpdGlvbi5pbmNsdWRlcyhwb3MpKXtcclxuICAgICAgICAgICAgICAgIGlmKHBsYXllci5zaGlwc1tpXS5oaXRzID09PSBwbGF5ZXIuc2hpcHNbaV0ubGVuZ3RoLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBoaXRTaGlwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld1BvcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBsYXllci5zaGlwc1tpXS5wb3NpdGlvbilcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhpdHRlZFNoaXAgPSBwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXIuc2hpcHNbaV0uaGl0KHBvcyk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb24pXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGhpdFNoaXApXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaGl0dGVkU2hpcFswXVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNvbXB1dGVyUGxheSA9ICgpPT57Ly8gcmFuZG9tIGNvbXB1dGVyIHBsYXlzXHJcbiAgICAgICAgY29uc3QgcGxheWVyc0JvYXJkID0gcGxheWVyLmJvYXJkLmJvYXJkUG9zaXRpb25BcnJheTtcclxuICAgICAgICBjb25zdCByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqcGxheWVyc0JvYXJkLmxlbmd0aCk7XHJcbiAgICAgICAgbGV0IHBvcyA9IHBsYXllcnNCb2FyZFtyYW5kb21OdW1iZXJdO1xyXG4gICAgICAgIC8vIHNtYXJ0IEFJO1xyXG4gICAgICAgIGlmKGhpdFNoaXApe1xyXG4gICAgICAgICAgICBwb3MgPSBzbWFydEhpdHRpbmdTaGlwcyhwcmV2cG9zLCBwb3MpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gcmVtb3ZlcyB0aGUgcG9zaXRpb24gZnJvbSBwbGF5ZXJzIGJvYXJkIGFmdGVyIHNob3RzXHJcbiAgICAgICBwbGF5ZXJzQm9hcmQuc3BsaWNlKHBsYXllcnNCb2FyZC5pbmRleE9mKHBvcyksIDEpO1xyXG4gICAgICAgICAgICBpZighKHNob3RzQXJyYXlDb21wLmluY2x1ZGVzKHBvcykpKXsvLyBubyBoaXR0aW5nIHNhbWUgcG9zaXRpb24gdHdpY2VcclxuICAgICAgICAgICAgICAgIHByZXZwb3MgPSBwb3M7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7cG9zfWApO1xyXG4gICAgICAgICAgICAgICAgc2hvdHNBcnJheUNvbXAucHVzaChwb3MpOy8vIHB1c2hpbmcgaGl0IHBvc2l0aW9uIHRvIGFycmF5XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzaGlwQXJyYXkgPSBwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5O1xyXG4gICAgICAgICAgICAgICAgaWYoc2hpcEFycmF5LmluY2x1ZGVzKHBvcykpey8vIGlmIHNoaXAgZ2V0cyBoaXQgZGl2IGNvbG9yIGNoYW5nZXMgdG8gcmVkXHJcbiAgICAgICAgICAgICAgICAgICAgaGl0U2hpcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaGl0U2hpcClcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hpcEFycmF5LnNwbGljZShzaGlwQXJyYXkuaW5kZXhPZihwb3MpLDEpOyAvLyByZW1vdmVzIHBvc2l0aW9uIGZyb20gc2hpcEFycmF5XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY2hlY2tHYW1lRW5kKHBsYXllcikpIHJldHVybiAwOy8vIGlmIGdhbWUgZW5kcyBubyBzd2l0Y2hpbmcgdHVybnNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7Ly8gaWYgbm90IGhpdCBkaXYgY2huYWdlcyB0byB5ZWxsb3dcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjaGFuZ2VzIHR1cm4gdG8gb3RoZXIgcGxheWVyXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LmFkZChcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJUd28uY2xhc3NMaXN0LnJlbW92ZShcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwbGF5ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyaWRJdGVtQ29tcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTIgLmdyaWQtaXRlbVwiKTtcclxuICAgIGdyaWRJdGVtQ29tcC5mb3JFYWNoKChpdGVtKT0+e1xyXG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBhcnNlRmxvYXQoaXRlbS5pZCk7XHJcbiAgICAgICAgICAgIGlmKCEoc2hvdHNBcnJheS5pbmNsdWRlcyhwb3MpKSl7Ly8gY2FuJ3QgaGl0IHNhbWUgcG9zaXRpb24gdHdpY2VcclxuICAgICAgICAgICAgICAgIHNob3RzQXJyYXkucHVzaChwb3MpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2hpcEFycmF5ID0gY29tcHV0ZXIuYm9hcmQuaGFzU2hpcEFycmF5O1xyXG4gICAgICAgICAgICAgICAgaWYoc2hpcEFycmF5LmluY2x1ZGVzKHBvcykpe1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjsvLyBoaXQgc2lnbmFsbGluZ1xyXG4gICAgICAgICAgICAgICAgICAgIHNoaXBBcnJheS5zcGxpY2Uoc2hpcEFycmF5LmluZGV4T2YocG9zKSwxKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihjaGVja0dhbWVFbmQoY29tcHV0ZXIpKSByZXR1cm4gMDsvLyBpZiBnYW1lIGVuZHMgbm8gc3dpdGNoaW5nIHR1cm5zXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHR1cm4gc3dpdGNoaW5nXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJUd28uY2xhc3NMaXN0LmFkZChcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LnJlbW92ZShcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICAvLyBjb21wdXRlciBhdHRhY2tzIGFmdGVyIDEgc2VjXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlclBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59IiwiaW1wb3J0IG1hbnVhbFBsYWNlbWVudCBmcm9tIFwiLi9tYW51YWxTaGlwc1BsYWNlbWVudFwiXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnYW1lU3RhcnQoKXtcclxuICAgIGNvbnN0IG1hbnVhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFudWFsXCIpO1xyXG4gICAgY29uc3Qgcm90YXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yb3RhdGVcIik7XHJcbiAgICBtYW51YWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgcm90YXRlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xyXG4gICAgICAgIG1hbnVhbFBsYWNlbWVudCgpO1xyXG4gICAgfSlcclxufSIsIi8qIGVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcbmltcG9ydCBTaGlwcyBmcm9tIFwiLi4vbW9kdWxlcy9zaGlwXCI7XHJcbmltcG9ydCB7IHBsYXllciwgc3RhcnRHYW1lIH0gZnJvbSBcIi4vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuZnVuY3Rpb24gbWFudWFsUGxhY2VtZW50KCl7XHJcbiAgICBjb25zdCBncmlkSXRlbVBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTEgLmdyaWQtaXRlbVwiKTtcclxuICAgIGNvbnN0IHJvdGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucm90YXRlXCIpO1xyXG4gICAgLy8gZm9yIGNoYW5nZWluZyB0aGUgZGlyZWN0aW9uIG9mIHRoZSBzaGlwc1xyXG4gICAgbGV0IGRpcmVjdGlvbiA9IDE7XHJcbiAgICByb3RhdGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSAxKXtcclxuICAgICAgICAgICAgZGlyZWN0aW9uID0gMTA7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvLyBkaXNwbGF5cyB0aGUgcGxheWVyT25lIHNoaXBzIGxvY2F0aW9uXHJcbiAgICBjb25zdCBzaGlwc0Rpc3BsYXkgPSAoKT0+e1xyXG4gICAgICAgIGdyaWRJdGVtUGxheWVyLmZvckVhY2goKGdyaWQpPT57XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIgXCI7XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgcmVkXCJcclxuICAgICAgICAgICAgaWYocGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhwYXJzZUludChncmlkLmlkLCAxMCkpKVxyXG4gICAgICAgICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJncmVlblwiKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBqID0gNTtcclxuICAgIGxldCBjb3VudCA9MDtcclxuICAgIGdyaWRJdGVtUGxheWVyLmZvckVhY2goKGdyaWQpPT57XHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICAgICAgLy8gdGFrZXMgYXJyYXkgYWNjciB0byB1c2VycyByZXF1ZXN0XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0FycmF5ID0gW107XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGo7aSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FycmF5RWxlbWVudCA9IHBhcnNlSW50KGdyaWQuaWQsIDEwKSsoaSpkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgbmV3QXJyYXkucHVzaChuZXdBcnJheUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGlmIG5vdCB2YWxpZCBjYW4ndCBwbGFjZVxyXG4gICAgICAgICAgICBpZighKHBsYXllci5ib2FyZC5zaGlwc1BsYWNlbWVudChuZXdBcnJheSkpKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHdoZW4gdmFsaWQgYWRkcyB0aGUgc2hpcCBhbmQgcHVzaGVzIGl0IGluXHJcbiAgICAgICAgICAgIGNvbnN0IHBsYXllclNoaXAgPSBuZXcgU2hpcHMoYHNoaXAtJHtjb3VudH1gLCBqLCBuZXdBcnJheSlcclxuICAgICAgICAgICAgcGxheWVyLnNoaXBzLnB1c2gocGxheWVyU2hpcCk7XHJcbiAgICAgICAgICAgIHNoaXBzRGlzcGxheSgpOy8vIGRpc3BsYXlzXHJcbiAgICAgICAgICAgIC8vIHdoZW4gc2hpcHMgY291bnQgcmVhY2ggNSBzdGFydHMgZ2FtZSBhdXRvbWF0aWNhbGx5XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGlmKGNvdW50ID09PSA1KSBzdGFydEdhbWUuY2xpY2soKTtcclxuICAgICAgICAgICAgLy8gbm8gc2hpcHMgbGVzcyB0aGFuIDIgaW4gc2l6ZVxyXG4gICAgICAgICAgICBpZihqID09PSAyKSByZXR1cm4gMDtcclxuICAgICAgICAgICAgLy8gZGVjcmVhc2VzIHRoZSBzaGlwcyBkaXNwbGF5IHRvIHVzZXIgYWZ0ZXIgZWFjaCBjbGlja1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vIGZvciBkaXNwbGF5aW5nIHRoZSByYW5nZSBvZiBzaGlwcyB0aGF0IGNhbiBiZSBwbGFjZWQgdG8gdGhlIHVzZXIgXHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpPT57XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPCBqOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JpZExpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwYXJzZUludChncmlkLmlkLCAxMCkrKGkqZGlyZWN0aW9uKX1gKTtcclxuICAgICAgICAgICAgICAgIGlmKGdyaWRMaW5lLmNsYXNzTGlzdFsxXSA9PT0gXCJncmVlblwiKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBncmlkTGluZS5zdHlsZS5ib3JkZXIgPSBcIjJweCBzb2xpZCBncmVlblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIycHggc29saWQgZ3JlZW5cIjtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyByZW1vdmVzIHRoZSBkaXNwbGF5IHdoZW4gdXNlcidzIG1vdXNlIG1vdmVzIGF3YXkgZnJvbSB0aGUgZGl2XHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKT0+e1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgNTsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyaWRMaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7cGFyc2VJbnQoZ3JpZC5pZCwgMTApKyhpKmRpcmVjdGlvbil9YCk7XHJcbiAgICAgICAgICAgICAgICBpZihncmlkTGluZS5jbGFzc0xpc3RbMV0gPT09IFwiZ3JlZW5cIikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZ3JpZExpbmUuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgcmVkXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZ3JpZC5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCByZWRcIjtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBtYW51YWxQbGFjZW1lbnQ7Il0sIm5hbWVzIjpbIlNoaXBzIiwiY29uc3RydWN0b3IiLCJuYW1lIiwibGVuZ3RoIiwicG9zaXRpb24iLCJoaXRzIiwidGhpcyIsImhhc1N1bmtlbiIsImhpdCIsInNwbGljZSIsImluZGV4T2YiLCJpc1N1bmsiLCJzaGlwcyIsImJvYXJkIiwiYm9hcmRQb3NpdGlvbkFycmF5IiwiaGFzU2hpcEFycmF5IiwiYm9hcmRDcmVhdGUiLCJpIiwicHVzaCIsInJlY2VpdmVBdHRhY2siLCJwb3MiLCJpbmNsdWRlcyIsImNoZWNraW5nSWZIaXQiLCJnYW1lRW5kIiwic2hpcHNQbGFjZW1lbnQiLCJzaGlwc0FyciIsInNob3J0ZWRTaGlwc0FyciIsInNvcnQiLCJhIiwiYiIsImJvcmRlckhvcml6b250YWwiLCJib3JkZXJWZXJ0aWNhbCIsImV2ZXJ5IiwiZWxlbSIsImNvbXB1dGVyIiwic3RhcnRHYW1lIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibWFrZVJvd3MiLCJkaXYiLCJyb3dzIiwiY29scyIsInN0eWxlIiwic2V0UHJvcGVydHkiLCJjIiwiY2VsbCIsImNyZWF0ZUVsZW1lbnQiLCJhcHBlbmRDaGlsZCIsImNsYXNzTGlzdCIsImFkZCIsImlkIiwicGxheWVyT25lIiwicGxheWVyVHdvIiwiZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbiIsImoiLCJwZXJzb24iLCJyYW5kb21OdW1iZXIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJuZXdBcnJheSIsImFkZGluZ0FycmF5IiwiYWRkaW5nRGlnaXQiLCJyYW5kb21pc2UiLCJidXR0dG9ucyIsImFkZEV2ZW50TGlzdGVuZXIiLCJncmlkSXRlbVBsYXllciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZ3JpZCIsImJhY2tncm91bmRDb2xvciIsInBsYXllclNoaXAiLCJwYXJzZUludCIsInBsYXllclNoaXBzIiwicG9pbnRlckV2ZW50cyIsImNvbXBTaGlwIiwiY29tcHV0ZXJTaGlwcyIsImRpc2FibGVkIiwicmVtb3ZlIiwiY2hlY2tHYW1lRW5kIiwicmVzZXRCdXR0b24iLCJ3aW5EaXNwbGF5IiwidGV4dENvbnRlbnQiLCJzaG90c0FycmF5Iiwic2hvdHNBcnJheUNvbXAiLCJwcmV2cG9zIiwiaGl0U2hpcCIsIml0ZW0iLCJwYXJzZUZsb2F0Iiwic2hpcEFycmF5Iiwic2V0VGltZW91dCIsInBsYXllcnNCb2FyZCIsIm5ld1BvcyIsImNvbnNvbGUiLCJsb2ciLCJoaXR0ZWRTaGlwIiwic21hcnRIaXR0aW5nU2hpcHMiLCJnZXRFbGVtZW50QnlJZCIsImNvbXB1dGVyUGxheSIsImhpdEJvYXJkIiwibWFudWFsQnV0dG9uIiwicm90YXRlIiwiZGlyZWN0aW9uIiwiY291bnQiLCJuZXdBcnJheUVsZW1lbnQiLCJib3JkZXIiLCJjbGljayIsImdyaWRMaW5lIiwiZ2FtZVN0YXJ0Il0sInNvdXJjZVJvb3QiOiIifQ==