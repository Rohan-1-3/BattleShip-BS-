(()=>{"use strict";class e{constructor(e,t,s,r=0){this.name=e,this.length=t,this.position=s,this.hits=r,this.hasSunken=!1}hit(e){this.position.splice(this.position.indexOf(e),1),this.hits++,this.isSunk(this.hits)}isSunk(){0===this.position.length&&(this.hasSunken=!0)}}const t=class{constructor(e){this.name=e,this.ships=[],this.board=new class{constructor(){this.boardPositionArray=[],this.hasShipArray=[],this.boardCreate()}boardCreate(){for(let e=0;e<100;e++)this.boardPositionArray.push(e)}receiveAttack(e){return this.boardPositionArray.includes(e)?(this.boardPositionArray.includes(e)&&this.boardPositionArray.splice(e,1),this.checkingIfHit(e)):"out of the box"}checkingIfHit(e){return!!this.hasShipArray.includes(e)&&(this.hasShipArray.splice(this.hasShipArray.indexOf(e),1),!0)}gameEnd(){return!(0!==this.hasShipArray.length)}shipsPlacement(e){const t=e.sort(((e,t)=>e-t)),s=[9,19,29,39,49,59,69,79,89,99],r=[90,91,92,93,94,95,96,97,98,99];for(let i=0;i<t.length-1;i++){if(e[i]<0)return!1;if(!this.boardPositionArray.includes(t[i]))return!1;if(this.hasShipArray.includes(e[i]))return!1;if(this.hasShipArray.includes(e[t.length-1]))return!1;if(t[i+1]-t[i]!=1&&t[i+1]-t[i]!=10)return!1;if(s.includes(t[i])||r.includes(t[i])){if(e.every((e=>s.includes(e)||r.includes(e))))break;if(i!==t.length||0!==i)return!1}}return this.hasShipArray.push(...t),!0}}}},s=new t("player"),r=new t("computer"),i=document.querySelector(".game-start");!function(){!function(){function e(e,t=10,s=10){e.style.setProperty("--grid-rows",t),e.style.setProperty("--grid-cols",s);for(let r=0;r<t*s;r++){const t=document.createElement("div");e.appendChild(t),t.classList.add("grid-item"),t.id=r}}const t=document.querySelector(".player-1"),s=document.querySelector(".player-2");e(t),e(s)}();const t=(e,s)=>{const r=Math.floor(100*Math.random()),i=[],o=[1,10,1,10,10,1,10,1],n=o[Math.floor(Math.random()*o.length)];for(let t=0;t<e;t++)i.push(r+t*n);return s.board.shipsPlacement(i)?i:t(e,s)},o=document.querySelector(".player-1"),n=document.querySelector(".player-2");n.classList.add("turn");const l=document.querySelector(".randomPlayer"),a=document.querySelector(".manual"),c=document.querySelector(".buttons");l.addEventListener("click",(()=>{(()=>{s.ships=[],s.board.hasShipArray=[];const r=document.querySelectorAll(".player-1 .grid-item");r.forEach((e=>{e.style.backgroundColor="rgb(17, 24, 39)"}));let i=5;for(let r=0;r<5;r++){const o=new e(`ship${r}`,i,t(i,s));s.ships.push(o),2!==i&&i--}for(let e=0;e<5;e++)0===e&&(s.board.hasShipArray=[]),s.board.shipsPlacement(s.ships[e].position);r.forEach((e=>{s.board.hasShipArray.includes(parseInt(e.id,10))&&(e.style.backgroundColor="green")}))})(),o.style.pointerEvents="none"})),i.addEventListener("click",(()=>16!==s.board.hasShipArray.length?(l.classList.add("invalid"),a.classList.add("invalid"),setTimeout((()=>{l.classList.remove("invalid"),a.classList.remove("invalid")}),2e3),!1):(c.classList.add("hide"),o.style.pointerEvents="none",(()=>{document.querySelector(".player-1").classList.add("turn");let s=5;for(let i=0;i<5;i++){const o=new e(`ship${i}`,s,t(s,r));r.ships.push(o),2!==s&&s--}for(let e=0;e<5;e++)0===e&&(r.board.hasShipArray=[]),r.board.shipsPlacement(r.ships[e].position)})(),l.disabled=!0,i.disabled=!0,n.classList.remove("turn"),0)))}(),function(){const e=e=>{if(0===e.board.hasShipArray.length){const t=document.querySelector(".reset");t.style.pointerEvents="all";const s=document.querySelector(".win-display");return s.textContent=`${e.name} lost`,s.classList.add("show"),t.classList.add("show"),document.querySelector(".game").style.pointerEvents="none",!0}return!1},t=[],i=[],o=document.querySelector(".player-1"),n=document.querySelector(".player-2");let l,a=!1;document.querySelectorAll(".player-2 .grid-item").forEach((c=>{c.addEventListener("click",(()=>{const d=parseFloat(c.id);if(!t.includes(d)){t.push(d);const h=r.board.hasShipArray;if(h.includes(d)){if(c.style.backgroundColor="red",h.splice(h.indexOf(d),1),e(r))return 0}else c.style.backgroundColor="yellow";n.classList.add("turn"),o.classList.remove("turn"),setTimeout((()=>{(()=>{const t=s.board.boardPositionArray;let r=t[Math.floor(Math.random()*t.length)];if(a&&(r=((e,t)=>{for(let r=0;r<5;r++)if(s.ships[r].position.includes(e)){if(s.ships[r].hits===s.ships[r].length-1)return a=!1,t;const i=s.ships[r].position;return s.ships[r].hit(e),i[0]}})(l,r)),t.splice(t.indexOf(r),1),!i.includes(r)){l=r;const t=document.getElementById(`${r}`);i.push(r);const c=s.board.hasShipArray;if(c.includes(r)){if(a=!0,t.style.backgroundColor="red",c.splice(c.indexOf(r),1),e(s))return 0}else t.style.backgroundColor="yellow";o.classList.add("turn"),n.classList.remove("turn"),console.log(s)}})()}),1e3)}return 0}))}))}(),function(){const t=document.querySelector(".manual"),r=document.querySelector(".rotate");t.addEventListener("click",(()=>{r.classList.remove("hide"),function(){const t=document.querySelectorAll(".player-1 .grid-item"),r=document.querySelector(".rotate");let o=1;r.addEventListener("click",(()=>{o=1===o?10:1}));let n=5,l=0;t.forEach((r=>{r.addEventListener("click",(()=>{const a=[];for(let e=0;e<n;e++){const t=parseInt(r.id,10)+e*o;a.push(t)}if(!s.board.shipsPlacement(a))return!1;const c=new e(`ship-${l}`,n,a);return s.ships.push(c),t.forEach((e=>{e.style.backgroundColor=" ",e.style.border="1px solid red",s.board.hasShipArray.includes(parseInt(e.id,10))&&e.classList.add("green")})),l++,5===l&&i.click(),2===n?0:(n--,!0)})),r.addEventListener("mouseover",(()=>{for(let e=1;e<n;e++){const t=document.getElementById(`${parseInt(r.id,10)+e*o}`);if("green"===t.classList[1])return!1;t.style.border="2px solid green"}r.style.border="2px solid green"})),r.addEventListener("mouseleave",(()=>{for(let e=1;e<5;e++){const t=document.getElementById(`${parseInt(r.id,10)+e*o}`);if("green"===t.classList[1])return!1;t.style.border="1px solid red"}r.style.border="1px solid red"}))}))}()}))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEdBQUd2QixTQUFTSCxFQUFLcEIsR0FBSSxJQUFLakMsRUFBRXFGLEtBQ3JFLEdBQTZCLFVBQTFCSyxFQUFTM0QsVUFBVSxHQUFnQixPQUFPLEVBQzdDMkQsRUFBU2pFLE1BQU0rRCxPQUFTLGlCQUM1QixDQUNBbkMsRUFBSzVCLE1BQU0rRCxPQUFTLGlCQUFpQixJQUd6Q25DLEVBQUtKLGlCQUFpQixjQUFjLEtBQ2hDLElBQUksSUFBSWpELEVBQUksRUFBR0EsRUFBSSxFQUFHQSxJQUFJLENBQ3RCLE1BQU0wRixFQUFXdkUsU0FBUzRELGVBQWUsR0FBR3ZCLFNBQVNILEVBQUtwQixHQUFJLElBQUtqQyxFQUFFcUYsS0FDckUsR0FBNkIsVUFBMUJLLEVBQVMzRCxVQUFVLEdBQWdCLE9BQU8sRUFDN0MyRCxFQUFTakUsTUFBTStELE9BQVMsZUFDNUIsQ0FDQW5DLEVBQUs1QixNQUFNK0QsT0FBUyxlQUFlLEdBQ3JDLEdBRVYsQ0RqRVEsRUFBaUIsR0FFekIsQ0ZIQUcsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9zaGlwUGxhY2VtZW50LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2hpdEdhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9nYW1lU3RhcnQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ3JlYXRpb24vbWFudWFsU2hpcHNQbGFjZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2hpcHN7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLGxlbmd0aCxwb3NpdGlvbiwgaGl0cyA9IDApe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5sZW5ndGggPSBsZW5ndGg7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMuaGl0cyA9IGhpdHM7XHJcbiAgICAgICAgdGhpcy5oYXNTdW5rZW4gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBoaXQocG9zaXRpb24pey8vIGhpdHMgdGhlIHBvc2l0aW9uIGFuZCByZW1vdmVzIHRoZSBwb3NpdGlvbiBmcm9tIHRoZSBhcnJheVxyXG4gICAgICAgIHRoaXMucG9zaXRpb24uc3BsaWNlKHRoaXMucG9zaXRpb24uaW5kZXhPZihwb3NpdGlvbiksMSk7XHJcbiAgICAgICAgdGhpcy5oaXRzKys7XHJcbiAgICAgICAgdGhpcy5pc1N1bmsodGhpcy5oaXRzKTtcclxuICAgIH1cclxuXHJcbiAgICBpc1N1bmsoKXsvLyBvbmNlIGFsbCBoaXQgaXQgc2lua3NcclxuICAgICAgICBpZih0aGlzLnBvc2l0aW9uLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmhhc1N1bmtlbiA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSIsImNsYXNzIEdhbWVCb2FyZHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgIHRoaXMuYm9hcmRDcmVhdGUoKTsvLyBpbnN0YW50bHkgY3JlYXRlcyBhIGJvYXJkXHJcbiAgICB9XHJcblxyXG4gICAgYm9hcmRDcmVhdGUoKXtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2k8MTAwO2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlY2VpdmVBdHRhY2socG9zKXsvLyByZWNlaXZlcyBhdHRhY2sgYW5kIG1hcmtzIGlmIGhpdCBvciBtaXNzXHJcbiAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHBvcykpIHJldHVybiBcIm91dCBvZiB0aGUgYm94XCI7XHJcbiAgICAgICAgaWYodGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkuaW5jbHVkZXMocG9zKSl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnNwbGljZShwb3MsMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNraW5nSWZIaXQocG9zKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja2luZ0lmSGl0KHBvcyl7XHJcbiAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMocG9zKSl7Ly8gY2hlY2tpbmcgaGl0LCBpZiBoaXQgcmVtb3ZlcyBibG9jayBmcm9tIHNoaXBBcnJheVxyXG4gICAgICAgICAgICB0aGlzLmhhc1NoaXBBcnJheS5zcGxpY2UodGhpcy5oYXNTaGlwQXJyYXkuaW5kZXhPZihwb3MpLDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdhbWVFbmQoKXsvLyBjaGVjayBpZiBhbGwgc2hpcHMgc3Vua1xyXG4gICAgICAgIHJldHVybiAhISh0aGlzLmhhc1NoaXBBcnJheS5sZW5ndGggPT09IDApO1xyXG4gICAgfVxyXG5cclxuICAgIHNoaXBzUGxhY2VtZW50KHNoaXBzQXJyKXtcclxuICAgICAgICBjb25zdCBzaG9ydGVkU2hpcHNBcnIgPSBzaGlwc0Fyci5zb3J0KChhLCBiKSA9PmEgLSBiKTsvLyBzb3J0aW5nXHJcbiAgICAgICAgLy8gYm9yZGVyIG9mIHRoZSBib2FyZFxyXG4gICAgICAgIGNvbnN0IGJvcmRlckhvcml6b250YWwgPSBbOSwxOSwyOSwzOSw0OSw1OSw2OSw3OSw4OSw5OV07XHJcbiAgICAgICAgY29uc3QgYm9yZGVyVmVydGljYWwgPSBbOTAsOTEsOTIsOTMsOTQsOTUsOTYsOTcsOTgsOTldO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoLTE7aSsrKXtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGJleW9uZCBib2FyZFxyXG4gICAgICAgICAgICBpZihzaGlwc0FycltpXTwwKSByZXR1cm4gZmFsc2U7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxhcHBpbmcgb2Ygc2hpcHNcclxuICAgICAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMoc2hpcHNBcnJbaV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHNoaXBzQXJyW3Nob3J0ZWRTaGlwc0Fyci5sZW5ndGgtMV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHBsYWNlbWVudCBpbiByYW5kb20gb3JkZXJcclxuICAgICAgICAgICAgaWYoISgoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxIFxyXG4gICAgICAgICAgICB8fCAoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxMCkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGNyb3NzZXMgdGhlIHZlcnRpY2FsIGFuZCBob3Jpem9udG9sIGJvcmRlclxyXG4gICAgICAgICAgICBpZihib3JkZXJIb3Jpem9udGFsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkgXHJcbiAgICAgICAgICAgIHx8IGJvcmRlclZlcnRpY2FsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpe1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihzaGlwc0Fyci5ldmVyeShlbGVtID0+IGJvcmRlckhvcml6b250YWwuaW5jbHVkZXMoZWxlbSkgXHJcbiAgICAgICAgICAgICAgICB8fCBib3JkZXJWZXJ0aWNhbC5pbmNsdWRlcyhlbGVtKSkpIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgaWYoIShpID09PSBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoICYmIGkgPT09IDApKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkcyBzaGlwIHRvIGZyZXNoIGxvY2F0aW9uXHJcbiAgICAgICAgdGhpcy5oYXNTaGlwQXJyYXkucHVzaCguLi5zaG9ydGVkU2hpcHNBcnIpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBHYW1lQm9hcmQiLCJpbXBvcnQgR2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xyXG5cclxuY2xhc3MgUGxheWVye1xyXG4gICAgY29uc3RydWN0b3IobmFtZSl7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnNoaXBzID0gW107XHJcbiAgICAgICAgdGhpcy5ib2FyZCA9IG5ldyBHYW1lQm9hcmQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBsYXllciIsIi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnRpbnVlICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcblxyXG5pbXBvcnQgUGxheWVyIGZyb20gXCIuLi9tb2R1bGVzL3BsYXllclwiXHJcbmltcG9ydCBTaGlwcyBmcm9tIFwiLi4vbW9kdWxlcy9zaGlwXCJcclxuaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcclxuXHJcbi8vIHR3byBuZXcgcGxheWVycyBjcmVhdGVkXHJcbmNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoXCJwbGF5ZXJcIik7XHJcbmNvbnN0IGNvbXB1dGVyID0gbmV3IFBsYXllcihcImNvbXB1dGVyXCIpO1xyXG5jb25zdCBzdGFydEdhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWUtc3RhcnRcIik7XHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNoaXBzKCl7XHJcbiAgICBnYW1lQm9hcmQoKTsvLyBib3ggYXJlYSBmb3IgYm90aCBwbGF5ZXJzXHJcblxyXG4gICAgY29uc3QgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbiA9IChqLCBwZXJzb24pPT57XHJcbiAgICAgICAgLy8gd2hlbiByYW5kb21pc2VkIHRoZSBzaGlwcyB3aWxsIGdldCBwbGFjZWQgZWl0aGVyIHZlcnRpY2FsIG9yIGhvcml6b250b2xcclxuICAgICAgICBjb25zdCByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApO1xyXG4gICAgICAgIGNvbnN0IG5ld0FycmF5ID0gW107XHJcbiAgICAgICAgY29uc3QgYWRkaW5nQXJyYXkgPSBbMSwxMCwxLDEwLDEwLDEsMTAsMV07XHJcbiAgICAgICAgY29uc3QgYWRkaW5nRGlnaXQgPSBhZGRpbmdBcnJheVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqYWRkaW5nQXJyYXkubGVuZ3RoKV07XHJcblxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGo7aSsrKXtcclxuICAgICAgICAgICAgbmV3QXJyYXkucHVzaChyYW5kb21OdW1iZXIrKGkgKiBhZGRpbmdEaWdpdCkpOy8vIGEgcmFuZG9tIG51bWJlciBhbmQgbWFrZSBhIHNlcmlhbGlzZWQgYXJyYXkgb2YgaXRcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocGVyc29uLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkgcmV0dXJuIG5ld0FycmF5Oy8vIGlmIHBsYWNlbWVudCBpdCBjb3JyZWN0IHJldHVybnNcclxuICAgICAgICByZXR1cm4gZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBwZXJzb24pOy8vIGlmIG5vdCByZWN1cnNpdmUgZnVuY3Rpb25cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGF5ZXJTaGlwcyA9ICgpPT57Ly8gY3JlYXRlcyBzaGlwcyBmb3IgcGxheWVyIGF0IHJhbmRvbSBwbGFjZXNcclxuICAgICAgICBwbGF5ZXIuc2hpcHMgPSBbXTtcclxuICAgICAgICBwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5ID0gW107XHJcbiAgICAgICAgY29uc3QgZ3JpZEl0ZW1QbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXllci0xIC5ncmlkLWl0ZW1cIik7XHJcbiAgICAgICAgZ3JpZEl0ZW1QbGF5ZXIuZm9yRWFjaCgoZ3JpZCk9PntcclxuICAgICAgICAgICAgZ3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcInJnYigxNywgMjQsIDM5KVwiO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgbGV0IGogPSA1O1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDU7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgcGxheWVyU2hpcCA9IG5ldyBTaGlwcyhgc2hpcCR7aX1gLGosIGdldFJhbmRvbUxlZ2FsUG9zaXRpb24oaiwgcGxheWVyKSk7XHJcbiAgICAgICAgICAgIHBsYXllci5zaGlwcy5wdXNoKHBsYXllclNoaXApO1xyXG4gICAgICAgICAgICAvLyBubyBzaGlwcyBsZXNzIHRoYW4gMiBpbiBzaXplXHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IobGV0IGkgPTA7IGk8NTtpKyspe1xyXG4gICAgICAgICAgICBpZihpPT09MCkgcGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheSA9IFtdOy8vIGNsZWFyaW5nIHRoZSBzaGlwIGFycmF5XHJcbiAgICAgICAgICAgIHBsYXllci5ib2FyZC5zaGlwc1BsYWNlbWVudChwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb24pOy8vIGZpbGxpbmcgaXQgd2l0aCBwcm9wZXIgcGxhY2VtZW50c1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ3JpZEl0ZW1QbGF5ZXIuZm9yRWFjaCgoZ3JpZCk9PnsvLyBzaG93aW5nIHRoZSBwbGF5ZXIncyBzaGlwIGxvY2F0aW9uXHJcbiAgICAgICAgaWYocGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhwYXJzZUludChncmlkLmlkLCAxMCkpKXtcclxuICAgICAgICAgICAgZ3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImdyZWVuXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9ICgpPT57XHJcbiAgICAgICAgY29uc3QgcGxheWVyT25lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMVwiKTtcclxuICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LmFkZChcInR1cm5cIik7IC8vIGRpc2JhbGluZyBET00gZm9yIG9wcG9zaXRlIHBsYXllclxyXG4gICAgICAgIGxldCBqID0gNTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCA1O2krKyl7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBTaGlwID0gbmV3IFNoaXBzKGBzaGlwJHtpfWAsaiwgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBjb21wdXRlcikpXHJcbiAgICAgICAgICAgIGNvbXB1dGVyLnNoaXBzLnB1c2goY29tcFNoaXApO1xyXG4gICAgICAgICAgICBpZihqID09PSAyKSBjb250aW51ZTtcclxuICAgICAgICAgICAgai0tO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yKGxldCBpID0wIDsgaTw1O2krKyl7XHJcbiAgICAgICAgICAgIGlmKGk9PT0wKSBjb21wdXRlci5ib2FyZC5oYXNTaGlwQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgY29tcHV0ZXIuYm9hcmQuc2hpcHNQbGFjZW1lbnQoY29tcHV0ZXIuc2hpcHNbaV0ucG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIHBsYXllclR3by5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTtcclxuICAgIC8vIGNyZWF0aW5nIHNoaXBzIHJhbmRvbWx5IGZvciB1c2VyXHJcbiAgICBjb25zdCByYW5kb21pc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhbmRvbVBsYXllclwiKTtcclxuICAgIGNvbnN0IG1hbnVhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFudWFsXCIpXHJcbiAgICBjb25zdCBidXR0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnV0dG9uc1wiKTtcclxuICAgIHJhbmRvbWlzZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBwbGF5ZXJTaGlwcygpO1xyXG4gICAgICAgIHBsYXllck9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XHJcbiAgICB9KVxyXG4gICAgLy8gc3RhcnRpbmcgdGhlIGdhbWUgYWZ0ZXIgcGxhY2VtZW50c1xyXG4gICAgc3RhcnRHYW1lLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKT0+e1xyXG4gICAgICAgIGlmKHBsYXllci5ib2FyZC5oYXNTaGlwQXJyYXkubGVuZ3RoICE9PSAxNil7XHJcbiAgICAgICAgICAgIHJhbmRvbWlzZS5jbGFzc0xpc3QuYWRkKFwiaW52YWxpZFwiKTtcclxuICAgICAgICAgICAgbWFudWFsQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJpbnZhbGlkXCIpOyAgICBcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByYW5kb21pc2UuY2xhc3NMaXN0LnJlbW92ZShcImludmFsaWRcIik7XHJcbiAgICAgICAgICAgICAgICBtYW51YWxCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImludmFsaWRcIik7XHJcbiAgICAgICAgICAgIH0sIDIwMDApO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfTsvLyBjYW47dCBzdGFydCBnYW1lIHdpdGhvdXQgcGxhY2VtZW50IG9mIGFsbCBzaGlwc1xyXG4gICAgICAgIGJ1dHR0b25zLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xyXG4gICAgICAgIHBsYXllck9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XHJcbiAgICAgICAgY29tcHV0ZXJTaGlwcygpO1xyXG4gICAgICAgIC8vIGRpc2JhbGluZyBET00gYnV0dG9uc1xyXG4gICAgICAgIHJhbmRvbWlzZS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgc3RhcnRHYW1lLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBwbGF5ZXJPbmUgY2FuIGF0dGFja1xyXG4gICAgICAgIHBsYXllclR3by5jbGFzc0xpc3QucmVtb3ZlKFwidHVyblwiKTtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH0pXHJcbiAgICBcclxufVxyXG5cclxuZXhwb3J0IHtwbGF5ZXIsIGNvbXB1dGVyLCBzdGFydEdhbWV9IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2FtZUJvYXJkKCl7XHJcbiAgICBmdW5jdGlvbiBtYWtlUm93cyhkaXYscm93cyA9IDEwLCBjb2xzPTEwKSB7XHJcbiAgICAgICAgZGl2LnN0eWxlLnNldFByb3BlcnR5KFwiLS1ncmlkLXJvd3NcIiwgcm93cyk7XHJcbiAgICAgICAgZGl2LnN0eWxlLnNldFByb3BlcnR5KFwiLS1ncmlkLWNvbHNcIiwgY29scyk7XHJcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCAocm93cyAqIGNvbHMpOyBjKyspIHtcclxuICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgZGl2LmFwcGVuZENoaWxkKGNlbGwpO1xyXG4gICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKFwiZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgICAgY2VsbC5pZCA9IGM7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIGNvbnN0IHBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTFcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0yXCIpO1xyXG4gICAgLy8gY3JlYXRlcyAxMHgxMCBib3ggZm9yIGJvdGggcGxheWVyc1xyXG4gICAgbWFrZVJvd3MocGxheWVyT25lKTtcclxuICAgIG1ha2VSb3dzKHBsYXllclR3byk7XHJcbn0iLCJpbXBvcnQgZ2FtZVN0YXJ0IGZyb20gXCIuL2dhbWVDcmVhdGlvbi9nYW1lU3RhcnRcIjtcclxuaW1wb3J0IGhpdEJvYXJkIGZyb20gXCIuL2dhbWVDcmVhdGlvbi9oaXRHYW1lQm9hcmRcIjtcclxuaW1wb3J0IHNoaXBzICBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuc2hpcHMoKTtcclxuaGl0Qm9hcmQoKTtcclxuZ2FtZVN0YXJ0KCk7IiwiLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cclxuLyogZXNsaW50LWRpc2FibGUgY29uc2lzdGVudC1yZXR1cm4gKi9cclxuaW1wb3J0IHsgY29tcHV0ZXIsIHBsYXllciB9IGZyb20gXCIuL3NoaXBQbGFjZW1lbnRcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGhpdEJvYXJkKCl7XHJcblxyXG4gICAgY29uc3QgY2hlY2tHYW1lRW5kID0gKHBlcnNvbik9PntcclxuICAgICAgICBpZihwZXJzb24uYm9hcmQuaGFzU2hpcEFycmF5Lmxlbmd0aCA9PT0gMCl7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc2V0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXNldFwiKTtcclxuICAgICAgICAgICAgcmVzZXRCdXR0b24uc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYWxsXCI7XHJcbiAgICAgICAgICAgIGNvbnN0IHdpbkRpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLndpbi1kaXNwbGF5XCIpO1xyXG4gICAgICAgICAgICB3aW5EaXNwbGF5LnRleHRDb250ZW50ID0gYCR7cGVyc29uLm5hbWV9IGxvc3RgO1xyXG4gICAgICAgICAgICB3aW5EaXNwbGF5LmNsYXNzTGlzdC5hZGQoXCJzaG93XCIpXHJcbiAgICAgICAgICAgIHJlc2V0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJzaG93XCIpO1xyXG4gICAgICAgICAgICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYW1lXCIpO1xyXG4gICAgICAgICAgICBtYWluLnN0eWxlLnBvaW50ZXJFdmVudHMgPSBcIm5vbmVcIjsgLy8gYWZ0ZXIgZ2FtZSBlbmRzIERPTSBhbGxvd2VkXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFycmF5IGZvciByZWNvcmRpbmcgc2hvdHNcclxuICAgIGNvbnN0IHNob3RzQXJyYXkgPSBbXTtcclxuICAgIGNvbnN0IHNob3RzQXJyYXlDb21wID0gW107XHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIGxldCBoaXRTaGlwID0gZmFsc2U7XHJcbiAgICBsZXQgcHJldnBvcztcclxuICBcclxuICAgIGNvbnN0IHNtYXJ0SGl0dGluZ1NoaXBzID0gKHBvcywgbmV3UG9zKT0+e1xyXG4gICAgICAgIC8vIGxvb3AgZm9yIGZpbmRpbmcgdGhlIHdoaWNoIHNoaXAgYmVlbnMgaGl0XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgNTtpKyspe1xyXG4gICAgICAgICAgICBpZihwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb24uaW5jbHVkZXMocG9zKSl7XHJcbiAgICAgICAgICAgICAgICBpZihwbGF5ZXIuc2hpcHNbaV0uaGl0cyA9PT0gcGxheWVyLnNoaXBzW2ldLmxlbmd0aC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gb25jZSBhbGwgcGFydCBvZiBzaGlwIGJlZW4gZGVzdHJveWVkIGNvbXB1dGVyIHN0YXJ0IG1ha2luZyByYW5kb20gbW92ZXNcclxuICAgICAgICAgICAgICAgICAgICBoaXRTaGlwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ld1BvcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnN0IGhpdHRlZFNoaXAgPSBwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb247Ly8gYXJyYXlQb3NpdGlvbiBvZiBoaXR0ZWQgU2hpcFxyXG4gICAgICAgICAgICAgICAgcGxheWVyLnNoaXBzW2ldLmhpdChwb3MpOyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHJldHVybiBoaXR0ZWRTaGlwWzBdOyAvLyByZXR1cm5zIGhpdHRlZCBTaGlwcyBhcnJheSBlbGVtZW50IG9uZSBieSBvbmVcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb21wdXRlclBsYXkgPSAoKT0+ey8vIHJhbmRvbSBjb21wdXRlciBwbGF5c1xyXG4gICAgICAgIGNvbnN0IHBsYXllcnNCb2FyZCA9IHBsYXllci5ib2FyZC5ib2FyZFBvc2l0aW9uQXJyYXk7XHJcbiAgICAgICAgY29uc3QgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKnBsYXllcnNCb2FyZC5sZW5ndGgpO1xyXG4gICAgICAgIGxldCBwb3MgPSBwbGF5ZXJzQm9hcmRbcmFuZG9tTnVtYmVyXTtcclxuICAgICAgICAvLyBzbWFydCBBSTtcclxuICAgICAgICBpZihoaXRTaGlwKXtcclxuICAgICAgICAgICAgcG9zID0gc21hcnRIaXR0aW5nU2hpcHMocHJldnBvcywgcG9zKTsgLy8gZ2V0dGluZyBoaXR0ZWQgU2hpcHMgcGFydFxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyByZW1vdmVzIHRoZSBwb3NpdGlvbiBmcm9tIHBsYXllcnMgYm9hcmQgYWZ0ZXIgc2hvdHNcclxuICAgICAgIHBsYXllcnNCb2FyZC5zcGxpY2UocGxheWVyc0JvYXJkLmluZGV4T2YocG9zKSwgMSk7XHJcbiAgICAgICAgICAgIGlmKCEoc2hvdHNBcnJheUNvbXAuaW5jbHVkZXMocG9zKSkpey8vIG5vIGhpdHRpbmcgc2FtZSBwb3NpdGlvbiB0d2ljZVxyXG4gICAgICAgICAgICAgICAgcHJldnBvcyA9IHBvcztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwb3N9YCk7XHJcbiAgICAgICAgICAgICAgICBzaG90c0FycmF5Q29tcC5wdXNoKHBvcyk7Ly8gcHVzaGluZyBoaXQgcG9zaXRpb24gdG8gYXJyYXlcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBBcnJheSA9IHBsYXllci5ib2FyZC5oYXNTaGlwQXJyYXk7XHJcbiAgICAgICAgICAgICAgICBpZihzaGlwQXJyYXkuaW5jbHVkZXMocG9zKSl7Ly8gaWYgc2hpcCBnZXRzIGhpdCBkaXYgY29sb3IgY2hhbmdlcyB0byByZWRcclxuICAgICAgICAgICAgICAgICAgICAvLyBvbmNlIGhpdCBzbWFydCBBSSB0dXJucyB0cnVlIGZvciBcclxuICAgICAgICAgICAgICAgICAgICBoaXRTaGlwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2hpcEFycmF5LnNwbGljZShzaGlwQXJyYXkuaW5kZXhPZihwb3MpLDEpOyAvLyByZW1vdmVzIHBvc2l0aW9uIGZyb20gc2hpcEFycmF5XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY2hlY2tHYW1lRW5kKHBsYXllcikpIHJldHVybiAwOy8vIGlmIGdhbWUgZW5kcyBubyBzd2l0Y2hpbmcgdHVybnNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2V7Ly8gaWYgbm90IGhpdCBkaXYgY2huYWdlcyB0byB5ZWxsb3dcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBjaGFuZ2VzIHR1cm4gdG8gb3RoZXIgcGxheWVyXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LmFkZChcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJUd28uY2xhc3NMaXN0LnJlbW92ZShcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwbGF5ZXIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyaWRJdGVtQ29tcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTIgLmdyaWQtaXRlbVwiKTtcclxuICAgIGdyaWRJdGVtQ29tcC5mb3JFYWNoKChpdGVtKT0+e1xyXG4gICAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgICAgIGNvbnN0IHBvcyA9IHBhcnNlRmxvYXQoaXRlbS5pZCk7XHJcbiAgICAgICAgICAgIGlmKCEoc2hvdHNBcnJheS5pbmNsdWRlcyhwb3MpKSl7Ly8gY2FuJ3QgaGl0IHNhbWUgcG9zaXRpb24gdHdpY2VcclxuICAgICAgICAgICAgICAgIHNob3RzQXJyYXkucHVzaChwb3MpO1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2hpcEFycmF5ID0gY29tcHV0ZXIuYm9hcmQuaGFzU2hpcEFycmF5O1xyXG4gICAgICAgICAgICAgICAgaWYoc2hpcEFycmF5LmluY2x1ZGVzKHBvcykpe1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjsvLyBoaXQgc2lnbmFsbGluZ1xyXG4gICAgICAgICAgICAgICAgICAgIHNoaXBBcnJheS5zcGxpY2Uoc2hpcEFycmF5LmluZGV4T2YocG9zKSwxKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihjaGVja0dhbWVFbmQoY29tcHV0ZXIpKSByZXR1cm4gMDsvLyBpZiBnYW1lIGVuZHMgbm8gc3dpdGNoaW5nIHR1cm5zXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIHR1cm4gc3dpdGNoaW5nXHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJUd28uY2xhc3NMaXN0LmFkZChcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LnJlbW92ZShcInR1cm5cIik7XHJcbiAgICAgICAgICAgICAgICAvLyBjb21wdXRlciBhdHRhY2tzIGFmdGVyIDEgc2VjXHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb21wdXRlclBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59IiwiaW1wb3J0IG1hbnVhbFBsYWNlbWVudCBmcm9tIFwiLi9tYW51YWxTaGlwc1BsYWNlbWVudFwiXHJcblxyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBnYW1lU3RhcnQoKXtcclxuICAgIGNvbnN0IG1hbnVhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFudWFsXCIpO1xyXG4gICAgY29uc3Qgcm90YXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yb3RhdGVcIik7XHJcbiAgICBtYW51YWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgcm90YXRlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xyXG4gICAgICAgIG1hbnVhbFBsYWNlbWVudCgpO1xyXG4gICAgfSlcclxufSIsIi8qIGVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcblxyXG5pbXBvcnQgU2hpcHMgZnJvbSBcIi4uL21vZHVsZXMvc2hpcFwiO1xyXG5pbXBvcnQgeyBwbGF5ZXIsIHN0YXJ0R2FtZSB9IGZyb20gXCIuL3NoaXBQbGFjZW1lbnRcIjtcclxuXHJcbmZ1bmN0aW9uIG1hbnVhbFBsYWNlbWVudCgpe1xyXG4gICAgY29uc3QgZ3JpZEl0ZW1QbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXllci0xIC5ncmlkLWl0ZW1cIik7XHJcbiAgICBjb25zdCByb3RhdGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJvdGF0ZVwiKTtcclxuICAgIC8vIGZvciBjaGFuZ2VpbmcgdGhlIGRpcmVjdGlvbiBvZiB0aGUgc2hpcHNcclxuICAgIGxldCBkaXJlY3Rpb24gPSAxO1xyXG4gICAgcm90YXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKT0+e1xyXG4gICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gMSl7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IDEwO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gZGlzcGxheXMgdGhlIHBsYXllck9uZSBzaGlwcyBsb2NhdGlvblxyXG4gICAgY29uc3Qgc2hpcHNEaXNwbGF5ID0gKCk9PntcclxuICAgICAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+e1xyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiIFwiO1xyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiXHJcbiAgICAgICAgICAgIGlmKHBsYXllci5ib2FyZC5oYXNTaGlwQXJyYXkuaW5jbHVkZXMocGFyc2VJbnQoZ3JpZC5pZCwgMTApKSlcclxuICAgICAgICAgICAgZ3JpZC5jbGFzc0xpc3QuYWRkKFwiZ3JlZW5cIik7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBsZXQgaiA9IDU7XHJcbiAgICBsZXQgY291bnQgPTA7XHJcbiAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+e1xyXG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgICAgIC8vIHRha2VzIGFycmF5IGFjY3IgdG8gdXNlcnMgcmVxdWVzdFxyXG4gICAgICAgICAgICBjb25zdCBuZXdBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCBqO2krKyl7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBcnJheUVsZW1lbnQgPSBwYXJzZUludChncmlkLmlkLCAxMCkrKGkqZGlyZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIG5ld0FycmF5LnB1c2gobmV3QXJyYXlFbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBpZiBub3QgdmFsaWQgY2FuJ3QgcGxhY2VcclxuICAgICAgICAgICAgaWYoIShwbGF5ZXIuYm9hcmQuc2hpcHNQbGFjZW1lbnQobmV3QXJyYXkpKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAvLyB3aGVuIHZhbGlkIGFkZHMgdGhlIHNoaXAgYW5kIHB1c2hlcyBpdCBpblxyXG4gICAgICAgICAgICBjb25zdCBwbGF5ZXJTaGlwID0gbmV3IFNoaXBzKGBzaGlwLSR7Y291bnR9YCwgaiwgbmV3QXJyYXkpXHJcbiAgICAgICAgICAgIHBsYXllci5zaGlwcy5wdXNoKHBsYXllclNoaXApO1xyXG4gICAgICAgICAgICBzaGlwc0Rpc3BsYXkoKTsvLyBkaXNwbGF5c1xyXG4gICAgICAgICAgICAvLyB3aGVuIHNoaXBzIGNvdW50IHJlYWNoIDUgc3RhcnRzIGdhbWUgYXV0b21hdGljYWxseVxyXG4gICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICBpZihjb3VudCA9PT0gNSkgc3RhcnRHYW1lLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIC8vIG5vIHNoaXBzIGxlc3MgdGhhbiAyIGluIHNpemVcclxuICAgICAgICAgICAgaWYoaiA9PT0gMikgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgIC8vIGRlY3JlYXNlcyB0aGUgc2hpcHMgZGlzcGxheSB0byB1c2VyIGFmdGVyIGVhY2ggY2xpY2tcclxuICAgICAgICAgICAgai0tO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvLyBmb3IgZGlzcGxheWluZyB0aGUgcmFuZ2Ugb2Ygc2hpcHMgdGhhdCBjYW4gYmUgcGxhY2VkIHRvIHRoZSB1c2VyIFxyXG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCAoKT0+e1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgajsgaSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGdyaWRMaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7cGFyc2VJbnQoZ3JpZC5pZCwgMTApKyhpKmRpcmVjdGlvbil9YCk7XHJcbiAgICAgICAgICAgICAgICBpZihncmlkTGluZS5jbGFzc0xpc3RbMV0gPT09IFwiZ3JlZW5cIikgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZ3JpZExpbmUuc3R5bGUuYm9yZGVyID0gXCIycHggc29saWQgZ3JlZW5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJvcmRlciA9IFwiMnB4IHNvbGlkIGdyZWVuXCI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gcmVtb3ZlcyB0aGUgZGlzcGxheSB3aGVuIHVzZXIncyBtb3VzZSBtb3ZlcyBhd2F5IGZyb20gdGhlIGRpdlxyXG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIiwgKCk9PntcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IDU7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBncmlkTGluZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3BhcnNlSW50KGdyaWQuaWQsIDEwKSsoaSpkaXJlY3Rpb24pfWApO1xyXG4gICAgICAgICAgICAgICAgaWYoZ3JpZExpbmUuY2xhc3NMaXN0WzFdID09PSBcImdyZWVuXCIpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGdyaWRMaW5lLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgcmVkXCI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgbWFudWFsUGxhY2VtZW50OyJdLCJuYW1lcyI6WyJTaGlwcyIsImNvbnN0cnVjdG9yIiwibmFtZSIsImxlbmd0aCIsInBvc2l0aW9uIiwiaGl0cyIsInRoaXMiLCJoYXNTdW5rZW4iLCJoaXQiLCJzcGxpY2UiLCJpbmRleE9mIiwiaXNTdW5rIiwic2hpcHMiLCJib2FyZCIsImJvYXJkUG9zaXRpb25BcnJheSIsImhhc1NoaXBBcnJheSIsImJvYXJkQ3JlYXRlIiwiaSIsInB1c2giLCJyZWNlaXZlQXR0YWNrIiwicG9zIiwiaW5jbHVkZXMiLCJjaGVja2luZ0lmSGl0IiwiZ2FtZUVuZCIsInNoaXBzUGxhY2VtZW50Iiwic2hpcHNBcnIiLCJzaG9ydGVkU2hpcHNBcnIiLCJzb3J0IiwiYSIsImIiLCJib3JkZXJIb3Jpem9udGFsIiwiYm9yZGVyVmVydGljYWwiLCJldmVyeSIsImVsZW0iLCJjb21wdXRlciIsInN0YXJ0R2FtZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1ha2VSb3dzIiwiZGl2Iiwicm93cyIsImNvbHMiLCJzdHlsZSIsInNldFByb3BlcnR5IiwiYyIsImNlbGwiLCJjcmVhdGVFbGVtZW50IiwiYXBwZW5kQ2hpbGQiLCJjbGFzc0xpc3QiLCJhZGQiLCJpZCIsInBsYXllck9uZSIsInBsYXllclR3byIsImdldFJhbmRvbUxlZ2FsUG9zaXRpb24iLCJqIiwicGVyc29uIiwicmFuZG9tTnVtYmVyIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwibmV3QXJyYXkiLCJhZGRpbmdBcnJheSIsImFkZGluZ0RpZ2l0IiwicmFuZG9taXNlIiwibWFudWFsQnV0dG9uIiwiYnV0dHRvbnMiLCJhZGRFdmVudExpc3RlbmVyIiwiZ3JpZEl0ZW1QbGF5ZXIiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImdyaWQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJwbGF5ZXJTaGlwIiwicGFyc2VJbnQiLCJwbGF5ZXJTaGlwcyIsInBvaW50ZXJFdmVudHMiLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwiY29tcFNoaXAiLCJjb21wdXRlclNoaXBzIiwiZGlzYWJsZWQiLCJjaGVja0dhbWVFbmQiLCJyZXNldEJ1dHRvbiIsIndpbkRpc3BsYXkiLCJ0ZXh0Q29udGVudCIsInNob3RzQXJyYXkiLCJzaG90c0FycmF5Q29tcCIsInByZXZwb3MiLCJoaXRTaGlwIiwiaXRlbSIsInBhcnNlRmxvYXQiLCJzaGlwQXJyYXkiLCJwbGF5ZXJzQm9hcmQiLCJuZXdQb3MiLCJoaXR0ZWRTaGlwIiwic21hcnRIaXR0aW5nU2hpcHMiLCJnZXRFbGVtZW50QnlJZCIsImNvbnNvbGUiLCJsb2ciLCJjb21wdXRlclBsYXkiLCJoaXRCb2FyZCIsInJvdGF0ZSIsImRpcmVjdGlvbiIsImNvdW50IiwibmV3QXJyYXlFbGVtZW50IiwiYm9yZGVyIiwiY2xpY2siLCJncmlkTGluZSIsImdhbWVTdGFydCJdLCJzb3VyY2VSb290IjoiIn0=