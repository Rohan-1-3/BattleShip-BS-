(()=>{"use strict";const e=class{constructor(e){this.name=e,this.ships=[],this.board=new class{constructor(){this.boardPositionArray=[],this.hasShipArray=[],this.boardCreate()}boardCreate(){for(let e=0;e<100;e++)this.boardPositionArray.push(e)}receiveAttack(e){return this.boardPositionArray.includes(e)?(this.boardPositionArray.includes(e)&&this.boardPositionArray.splice(e,1),this.checkingIfHit(e)):"out of the box"}checkingIfHit(e){return!!this.hasShipArray.includes(e)&&(this.hasShipArray.splice(this.hasShipArray.indexOf(e),1),!0)}gameEnd(){return!(0!==this.hasShipArray.length)}shipsPlacement(e){const r=e.sort(((e,r)=>e-r)),t=[9,19,29,39,49,59,69,79,89,99],s=[90,91,92,93,94,95,96,97,98,99];for(let o=0;o<r.length-1;o++){if(e[o]<0)return!1;if(!this.boardPositionArray.includes(r[o]))return!1;if(this.hasShipArray.includes(e[o]))return!1;if(this.hasShipArray.includes(e[r.length-1]))return!1;if(r[o+1]-r[o]!=1&&r[o+1]-r[o]!=10)return!1;if(t.includes(r[o])||s.includes(r[o])){if(e.every((e=>t.includes(e)||s.includes(e))))break;if(o!==r.length||0!==o)return!1}}return this.hasShipArray.push(...r),!0}}}};class r{constructor(e,r,t,s=0){this.name=e,this.length=r,this.position=t,this.hits=s,this.hasSunken=!1}hit(e){this.position.splice(this.position.indexOf(e),1),this.hits++,this.isSunk(this.hits)}isSunk(){0===this.position.length&&(this.hasSunken=!0)}}const t=new e("player"),s=new e("computer"),o=document.querySelector(".game-start");!function(){!function(){function e(e,r=10,t=10){e.style.setProperty("--grid-rows",r),e.style.setProperty("--grid-cols",t);for(let s=0;s<r*t;s++){const r=document.createElement("div");e.appendChild(r),r.classList.add("grid-item"),r.id=s}}const r=document.querySelector(".player-1"),t=document.querySelector(".player-2");e(r),e(t)}();const e=(r,t)=>{const s=Math.floor(100*Math.random()),o=[],i=[1,10,1,10,10,1,10,1],n=i[Math.floor(Math.random()*i.length)];for(let e=0;e<r;e++)o.push(s+e*n);return t.board.shipsPlacement(o)?o:e(r,t)},i=document.querySelector(".player-1"),n=document.querySelector(".player-2");n.classList.add("turn");const a=document.querySelector(".randomPlayer");a.addEventListener("click",(()=>{(()=>{t.ships=[],t.board.hasShipArray=[];const s=document.querySelectorAll(".player-1 .grid-item");s.forEach((e=>{e.style.backgroundColor="white"}));let o=5;for(let s=0;s<5;s++){const i=new r(`ship${s}`,o,e(o,t));t.ships.push(i),2!==o&&o--}for(let e=0;e<5;e++)0===e&&(t.board.hasShipArray=[]),t.board.shipsPlacement(t.ships[e].position);s.forEach((e=>{t.board.hasShipArray.includes(parseInt(e.id,10))&&(e.style.backgroundColor="green")}))})()})),o.addEventListener("click",(()=>16===t.board.hasShipArray.length&&(i.style.pointerEvents="none",(()=>{document.querySelector(".player-1").classList.add("turn");let t=5;for(let o=0;o<5;o++){const i=new r(`ship${o}`,t,e(t,s));s.ships.push(i),2!==t&&t--}for(let e=0;e<5;e++)0===e&&(s.board.hasShipArray=[]),s.board.shipsPlacement(s.ships[e].position)})(),a.disabled=!0,o.disabled=!0,n.classList.remove("turn"),0)))}(),function(){const e=e=>0===e.board.hasShipArray.length&&(document.querySelector(".game").style.pointerEvents="none",console.log(`${e.name} Lost`),!0),r=[],o=[],i=document.querySelector(".player-1"),n=document.querySelector(".player-2");document.querySelectorAll(".player-2 .grid-item").forEach((a=>{a.addEventListener("click",(()=>{const l=parseFloat(a.id);if(!r.includes(l)){r.push(l);const c=s.board.hasShipArray;if(c.includes(l)){if(a.style.backgroundColor="red",c.splice(c.indexOf(l),1),e(s))return 0}else a.style.backgroundColor="yellow";n.classList.add("turn"),i.classList.remove("turn"),setTimeout((()=>{(()=>{const r=Math.floor(Math.random()*t.board.boardPositionArray.length),s=t.board.boardPositionArray[r];if(t.board.boardPositionArray.splice(r,1),!o.includes(s)){const r=document.getElementById(`${s}`);o.push(s);const a=t.board.hasShipArray;if(a.includes(s)){if(r.style.backgroundColor="red",a.splice(a.indexOf(s),1),e(t))return 0}else r.style.backgroundColor="yellow";i.classList.add("turn"),n.classList.remove("turn")}})()}),1e3)}return 0}))}))}(),function(){const e=document.querySelectorAll(".player-1 .grid-item"),s=document.querySelector(".rotate");let i=1;s.addEventListener("click",(()=>{i=1===i?10:1}));let n=5,a=0;e.forEach((s=>{s.addEventListener("click",(()=>{const l=[];for(let e=0;e<n;e++){const r=parseInt(s.id,10)+e*i;l.push(r)}if(!t.board.shipsPlacement(l))return!1;const c=new r(`ship-${a}`,n,l);return t.ships.push(c),console.log(t),e.forEach((e=>{e.style.backgroundColor=" ",e.style.border="1px solid red",t.board.hasShipArray.includes(parseInt(e.id,10))&&e.classList.add("green")})),a++,5===a&&o.click(),2===n?0:(n--,!0)})),s.addEventListener("mouseover",(()=>{for(let e=1;e<n;e++){const r=document.getElementById(`${parseInt(s.id,10)+e*i}`);if("green"===r.classList[1])return!1;r.style.border="2px solid green"}s.style.border="2px solid green"})),s.addEventListener("mouseleave",(()=>{for(let e=1;e<5;e++){const r=document.getElementById(`${parseInt(s.id,10)+e*i}`);if("green"===r.classList[1])return!1;r.style.border="1px solid red"}s.style.border="1px solid red"}))}))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU13RixFQUFXNUQsU0FBU21ELGVBQWUsR0FBR2hCLFNBQVNILEVBQUtsQixHQUFJLElBQUsxQyxFQUFFbUYsS0FDckUsR0FBNkIsVUFBMUJLLEVBQVNoRCxVQUFVLEdBQWdCLE9BQU8sRUFDN0NnRCxFQUFTdEQsTUFBTW9ELE9BQVMsaUJBQzVCLENBQ0ExQixFQUFLMUIsTUFBTW9ELE9BQVMsaUJBQWlCLElBRXpDMUIsRUFBS0osaUJBQWlCLGNBQWMsS0FDaEMsSUFBSSxJQUFJeEQsRUFBSSxFQUFHQSxFQUFJLEVBQUdBLElBQUksQ0FDdEIsTUFBTXdGLEVBQVc1RCxTQUFTbUQsZUFBZSxHQUFHaEIsU0FBU0gsRUFBS2xCLEdBQUksSUFBSzFDLEVBQUVtRixLQUNyRSxHQUE2QixVQUExQkssRUFBU2hELFVBQVUsR0FBZ0IsT0FBTyxFQUM3Q2dELEVBQVN0RCxNQUFNb0QsT0FBUyxlQUM1QixDQUNBMUIsRUFBSzFCLE1BQU1vRCxPQUFTLGVBQWUsR0FDckMsR0FFVixDRjFEQUcsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9nYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9zaGlwUGxhY2VtZW50LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL2hpdEdhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVDcmVhdGlvbi9tYW51YWxTaGlwc1BsYWNlbWVudC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBHYW1lQm9hcmR7XHJcbiAgICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5ID0gW107XHJcbiAgICAgICAgdGhpcy5oYXNTaGlwQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmJvYXJkQ3JlYXRlKCk7Ly8gaW5zdGFudGx5IGNyZWF0ZXMgYSBib2FyZFxyXG4gICAgfVxyXG5cclxuICAgIGJvYXJkQ3JlYXRlKCl7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpPDEwMDtpKyspe1xyXG4gICAgICAgICAgICB0aGlzLmJvYXJkUG9zaXRpb25BcnJheS5wdXNoKGkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWNlaXZlQXR0YWNrKHBvcyl7Ly8gcmVjZWl2ZXMgYXR0YWNrIGFuZCBtYXJrcyBpZiBoaXQgb3IgbWlzc1xyXG4gICAgICAgIGlmKCF0aGlzLmJvYXJkUG9zaXRpb25BcnJheS5pbmNsdWRlcyhwb3MpKSByZXR1cm4gXCJvdXQgb2YgdGhlIGJveFwiO1xyXG4gICAgICAgIGlmKHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHBvcykpe1xyXG4gICAgICAgICAgICB0aGlzLmJvYXJkUG9zaXRpb25BcnJheS5zcGxpY2UocG9zLDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jaGVja2luZ0lmSGl0KHBvcyk7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tpbmdJZkhpdChwb3Mpe1xyXG4gICAgICAgIGlmKHRoaXMuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHBvcykpey8vIGNoZWNraW5nIGhpdCwgaWYgaGl0IHJlbW92ZXMgYmxvY2sgZnJvbSBzaGlwQXJyYXlcclxuICAgICAgICAgICAgdGhpcy5oYXNTaGlwQXJyYXkuc3BsaWNlKHRoaXMuaGFzU2hpcEFycmF5LmluZGV4T2YocG9zKSwxKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBnYW1lRW5kKCl7Ly8gY2hlY2sgaWYgYWxsIHNoaXBzIHN1bmtcclxuICAgICAgICByZXR1cm4gISEodGhpcy5oYXNTaGlwQXJyYXkubGVuZ3RoID09PSAwKTtcclxuICAgIH1cclxuXHJcbiAgICBzaGlwc1BsYWNlbWVudChzaGlwc0Fycil7XHJcbiAgICAgICAgY29uc3Qgc2hvcnRlZFNoaXBzQXJyID0gc2hpcHNBcnIuc29ydCgoYSwgYikgPT5hIC0gYik7Ly8gc29ydGluZ1xyXG4gICAgICAgIC8vIGJvcmRlciBvZiB0aGUgYm9hcmRcclxuICAgICAgICBjb25zdCBib3JkZXJIb3Jpem9udGFsID0gWzksMTksMjksMzksNDksNTksNjksNzksODksOTldO1xyXG4gICAgICAgIGNvbnN0IGJvcmRlclZlcnRpY2FsID0gWzkwLDkxLDkyLDkzLDk0LDk1LDk2LDk3LDk4LDk5XTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hvcnRlZFNoaXBzQXJyLmxlbmd0aC0xO2krKyl7XHJcbiAgICAgICAgICAgIC8vIHBsYWNlbWVudCBiZXlvbmQgYm9hcmRcclxuICAgICAgICAgICAgaWYoc2hpcHNBcnJbaV08MCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmJvYXJkUG9zaXRpb25BcnJheS5pbmNsdWRlcyhzaG9ydGVkU2hpcHNBcnJbaV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIG5vIG92ZXJsYXBwaW5nIG9mIHNoaXBzXHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHNoaXBzQXJyW2ldKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBpZih0aGlzLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhzaGlwc0FycltzaG9ydGVkU2hpcHNBcnIubGVuZ3RoLTFdKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAvLyBwbGFjZW1lbnQgaW4gcmFuZG9tIG9yZGVyXHJcbiAgICAgICAgICAgIGlmKCEoKHNob3J0ZWRTaGlwc0FycltpKzFdIC0gc2hvcnRlZFNoaXBzQXJyW2ldKSA9PT0gMSBcclxuICAgICAgICAgICAgfHwgKHNob3J0ZWRTaGlwc0FycltpKzFdIC0gc2hvcnRlZFNoaXBzQXJyW2ldKSA9PT0gMTApKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHBsYWNlbWVudCBjcm9zc2VzIHRoZSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRvbCBib3JkZXJcclxuICAgICAgICAgICAgaWYoYm9yZGVySG9yaXpvbnRhbC5pbmNsdWRlcyhzaG9ydGVkU2hpcHNBcnJbaV0pIFxyXG4gICAgICAgICAgICB8fCBib3JkZXJWZXJ0aWNhbC5pbmNsdWRlcyhzaG9ydGVkU2hpcHNBcnJbaV0pKXtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoc2hpcHNBcnIuZXZlcnkoZWxlbSA9PiBib3JkZXJIb3Jpem9udGFsLmluY2x1ZGVzKGVsZW0pIFxyXG4gICAgICAgICAgICAgICAgfHwgYm9yZGVyVmVydGljYWwuaW5jbHVkZXMoZWxlbSkpKSBicmVhaztcclxuICAgICAgICAgICAgICAgIGlmKCEoaSA9PT0gc2hvcnRlZFNoaXBzQXJyLmxlbmd0aCAmJiBpID09PSAwKSkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGFkZHMgc2hpcCB0byBmcmVzaCBsb2NhdGlvblxyXG4gICAgICAgIHRoaXMuaGFzU2hpcEFycmF5LnB1c2goLi4uc2hvcnRlZFNoaXBzQXJyKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgR2FtZUJvYXJkIiwiaW1wb3J0IEdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcclxuXHJcbmNsYXNzIFBsYXllcntcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUpe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5zaGlwcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuYm9hcmQgPSBuZXcgR2FtZUJvYXJkO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBQbGF5ZXIiLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTaGlwc3tcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsbGVuZ3RoLHBvc2l0aW9uLCBoaXRzID0gMCl7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5oaXRzID0gaGl0cztcclxuICAgICAgICB0aGlzLmhhc1N1bmtlbiA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGhpdChwb3NpdGlvbil7Ly8gaGl0cyB0aGUgcG9zaXRpb24gYW5kIHJlbW92ZXMgdGhlIHBvc2l0aW9uIGZyb20gdGhlIGFycmF5XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbi5zcGxpY2UodGhpcy5wb3NpdGlvbi5pbmRleE9mKHBvc2l0aW9uKSwxKTtcclxuICAgICAgICB0aGlzLmhpdHMrKztcclxuICAgICAgICB0aGlzLmlzU3Vuayh0aGlzLmhpdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIGlzU3Vuaygpey8vIG9uY2UgYWxsIGhpdCBpdCBzaW5rc1xyXG4gICAgICAgIGlmKHRoaXMucG9zaXRpb24ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFzU3Vua2VuID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59IiwiLyogZXNsaW50LWRpc2FibGUgbm8tY29udGludWUgKi9cclxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cclxuaW1wb3J0IFBsYXllciBmcm9tIFwiLi4vbW9kdWxlcy9wbGF5ZXJcIlxyXG5pbXBvcnQgU2hpcHMgZnJvbSBcIi4uL21vZHVsZXMvc2hpcFwiXHJcbmltcG9ydCBnYW1lQm9hcmQgZnJvbSBcIi4vZ2FtZUJvYXJkXCI7XHJcblxyXG4vLyB0d28gbmV3IHBsYXllcnMgY3JlYXRlZFxyXG5jb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKFwicGxheWVyXCIpO1xyXG5jb25zdCBjb21wdXRlciA9IG5ldyBQbGF5ZXIoXCJjb21wdXRlclwiKTtcclxuY29uc3Qgc3RhcnRHYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYW1lLXN0YXJ0XCIpO1xyXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzaGlwcygpe1xyXG4gICAgZ2FtZUJvYXJkKCk7Ly8gYm94IGFyZWEgZm9yIGJvdGggcGxheWVyc1xyXG5cclxuICAgIGNvbnN0IGdldFJhbmRvbUxlZ2FsUG9zaXRpb24gPSAoaiwgcGVyc29uKT0+e1xyXG4gICAgICAgIC8vIHdoZW4gcmFuZG9taXNlZCB0aGUgc2hpcHMgd2lsbCBnZXQgcGxhY2VkIGVpdGhlciB2ZXJ0aWNhbCBvciBob3Jpem9udG9sXHJcbiAgICAgICAgY29uc3QgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTtcclxuICAgICAgICBjb25zdCBuZXdBcnJheSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGFkZGluZ0FycmF5ID0gWzEsMTAsMSwxMCwxMCwxLDEwLDFdO1xyXG4gICAgICAgIGNvbnN0IGFkZGluZ0RpZ2l0ID0gYWRkaW5nQXJyYXlbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmFkZGluZ0FycmF5Lmxlbmd0aCldO1xyXG5cclxuICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCBqO2krKyl7XHJcbiAgICAgICAgICAgIG5ld0FycmF5LnB1c2gocmFuZG9tTnVtYmVyKyhpICogYWRkaW5nRGlnaXQpKTsvLyBhIHJhbmRvbSBudW1iZXIgYW5kIG1ha2UgYSBzZXJpYWxpc2VkIGFycmF5IG9mIGl0XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHBlcnNvbi5ib2FyZC5zaGlwc1BsYWNlbWVudChuZXdBcnJheSkpIHJldHVybiBuZXdBcnJheTsvLyBpZiBwbGFjZW1lbnQgaXQgY29ycmVjdCByZXR1cm5zXHJcbiAgICAgICAgcmV0dXJuIGdldFJhbmRvbUxlZ2FsUG9zaXRpb24oaiwgcGVyc29uKTsvLyBpZiBub3QgcmVjdXJzaXZlIGZ1bmN0aW9uXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcGxheWVyU2hpcHMgPSAoKT0+ey8vIGNyZWF0ZXMgc2hpcHMgZm9yIHBsYXllciBhdCByYW5kb20gcGxhY2VzXHJcbiAgICAgICAgcGxheWVyLnNoaXBzID0gW107XHJcbiAgICAgICAgcGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGdyaWRJdGVtUGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wbGF5ZXItMSAuZ3JpZC1pdGVtXCIpO1xyXG4gICAgICAgIGdyaWRJdGVtUGxheWVyLmZvckVhY2goKGdyaWQpPT57XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ3aGl0ZVwiO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgbGV0IGogPSA1O1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDU7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgcGxheWVyU2hpcCA9IG5ldyBTaGlwcyhgc2hpcCR7aX1gLGosIGdldFJhbmRvbUxlZ2FsUG9zaXRpb24oaiwgcGxheWVyKSk7XHJcbiAgICAgICAgICAgIHBsYXllci5zaGlwcy5wdXNoKHBsYXllclNoaXApO1xyXG4gICAgICAgICAgICAvLyBubyBzaGlwcyBsZXNzIHRoYW4gMiBpbiBzaXplXHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IobGV0IGkgPTA7IGk8NTtpKyspe1xyXG4gICAgICAgICAgICBpZihpPT09MCkgcGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheSA9IFtdOy8vIGNsZWFyaW5nIHRoZSBzaGlwIGFycmF5XHJcbiAgICAgICAgICAgIHBsYXllci5ib2FyZC5zaGlwc1BsYWNlbWVudChwbGF5ZXIuc2hpcHNbaV0ucG9zaXRpb24pOy8vIGZpbGxpbmcgaXQgd2l0aCBwcm9wZXIgcGxhY2VtZW50c1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ3JpZEl0ZW1QbGF5ZXIuZm9yRWFjaCgoZ3JpZCk9PnsvLyBzaG93aW5nIHRoZSBwbGF5ZXIncyBzaGlwIGxvY2F0aW9uXHJcbiAgICAgICAgaWYocGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhwYXJzZUludChncmlkLmlkLCAxMCkpKXtcclxuICAgICAgICAgICAgZ3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcImdyZWVuXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9ICgpPT57XHJcbiAgICAgICAgY29uc3QgcGxheWVyT25lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMVwiKTtcclxuICAgICAgICBwbGF5ZXJPbmUuY2xhc3NMaXN0LmFkZChcInR1cm5cIik7IC8vIGRpc2JhbGluZyBET00gZm9yIG9wcG9zaXRlIHBsYXllclxyXG4gICAgICAgIGxldCBqID0gNTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCA1O2krKyl7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbXBTaGlwID0gbmV3IFNoaXBzKGBzaGlwJHtpfWAsaiwgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBjb21wdXRlcikpXHJcbiAgICAgICAgICAgIGNvbXB1dGVyLnNoaXBzLnB1c2goY29tcFNoaXApO1xyXG4gICAgICAgICAgICBpZihqID09PSAyKSBjb250aW51ZTtcclxuICAgICAgICAgICAgai0tO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZm9yKGxldCBpID0wIDsgaTw1O2krKyl7XHJcbiAgICAgICAgICAgIGlmKGk9PT0wKSBjb21wdXRlci5ib2FyZC5oYXNTaGlwQXJyYXkgPSBbXTtcclxuICAgICAgICAgICAgY29tcHV0ZXIuYm9hcmQuc2hpcHNQbGFjZW1lbnQoY29tcHV0ZXIuc2hpcHNbaV0ucG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIHBsYXllclR3by5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTtcclxuICAgIC8vIGNyZWF0aW5nIHNoaXBzIHJhbmRvbWx5IGZvciB1c2VyXHJcbiAgICBjb25zdCByYW5kb21pc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhbmRvbVBsYXllclwiKTtcclxuICAgIHJhbmRvbWlzZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBwbGF5ZXJTaGlwcygpO1xyXG4gICAgfSlcclxuICAgIC8vIHN0YXJ0aW5nIHRoZSBnYW1lIGFmdGVyIHBsYWNlbWVudHNcclxuICAgIHN0YXJ0R2FtZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBpZihwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5Lmxlbmd0aCAhPT0gMTYpIHJldHVybiBmYWxzZVxyXG4gICAgICAgIHBsYXllck9uZS5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XHJcbiAgICAgICAgY29tcHV0ZXJTaGlwcygpO1xyXG4gICAgICAgIHJhbmRvbWlzZS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgc3RhcnRHYW1lLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICBwbGF5ZXJUd28uY2xhc3NMaXN0LnJlbW92ZShcInR1cm5cIik7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9KVxyXG4gICAgXHJcbn1cclxuXHJcbmV4cG9ydCB7cGxheWVyLCBjb21wdXRlciwgc3RhcnRHYW1lfSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdhbWVCb2FyZCgpe1xyXG4gICAgZnVuY3Rpb24gbWFrZVJvd3MoZGl2LHJvd3MgPSAxMCwgY29scz0xMCkge1xyXG4gICAgICAgIGRpdi5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZ3JpZC1yb3dzXCIsIHJvd3MpO1xyXG4gICAgICAgIGRpdi5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZ3JpZC1jb2xzXCIsIGNvbHMpO1xyXG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgKHJvd3MgKiBjb2xzKTsgYysrKSB7XHJcbiAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChjZWxsKTtcclxuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImdyaWQtaXRlbVwiKTtcclxuICAgICAgICAgIGNlbGwuaWQgPSBjO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIC8vIGNyZWF0ZXMgMTB4MTAgYm94IGZvciBib3RoIHBsYXllcnNcclxuICAgIG1ha2VSb3dzKHBsYXllck9uZSk7XHJcbiAgICBtYWtlUm93cyhwbGF5ZXJUd28pO1xyXG59IiwiaW1wb3J0IGhpdEJvYXJkIGZyb20gXCIuL2dhbWVDcmVhdGlvbi9oaXRHYW1lQm9hcmRcIjtcclxuaW1wb3J0IHNvbWVGdW5jdGlvbiBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vbWFudWFsU2hpcHNQbGFjZW1lbnRcIjtcclxuaW1wb3J0IHNoaXBzICBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuXHJcbnNoaXBzKCk7XHJcbmhpdEJvYXJkKCk7XHJcbnNvbWVGdW5jdGlvbigpO1xyXG5cclxuXHJcbiIsIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1jeWNsZSAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xyXG5pbXBvcnQgeyBjb21wdXRlciwgcGxheWVyIH0gZnJvbSBcIi4vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaGl0Qm9hcmQoKXtcclxuXHJcbiAgICBjb25zdCBjaGVja0dhbWVFbmQgPSAocGVyc29uKT0+e1xyXG4gICAgICAgIGlmKHBlcnNvbi5ib2FyZC5oYXNTaGlwQXJyYXkubGVuZ3RoID09PSAwKXtcclxuICAgICAgICAgICAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZVwiKTtcclxuICAgICAgICAgICAgbWFpbi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7IC8vIGFmdGVyIGdhbWUgZW5kcyBET00gYWxsb3dlZFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwZXJzb24ubmFtZX0gTG9zdGApOyAvLyBpZGlzcGxheXNcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYXJyYXkgZm9yIHJlY29yZGluZyBzaG90c1xyXG4gICAgY29uc3Qgc2hvdHNBcnJheSA9IFtdO1xyXG4gICAgY29uc3Qgc2hvdHNBcnJheUNvbXAgPSBbXTtcclxuICAgIGNvbnN0IHBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTFcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0yXCIpO1xyXG4gIFxyXG4gICAgXHJcblxyXG4gICAgY29uc3QgY29tcHV0ZXJQbGF5ID0gKCk9PnsvLyByYW5kb20gY29tcHV0ZXIgcGxheXNcclxuICAgICAgICBjb25zdCByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqcGxheWVyLmJvYXJkLmJvYXJkUG9zaXRpb25BcnJheS5sZW5ndGgpXHJcbiAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLmJvYXJkLmJvYXJkUG9zaXRpb25BcnJheVtyYW5kb21OdW1iZXJdO1xyXG4gICAgICAgIC8vIHJlbW92ZXMgdGhlIHBvc2l0aW9uIGZyb20gcGxheWVycyBib2FyZCBhZnRlciBzaG90c1xyXG4gICAgICAgIHBsYXllci5ib2FyZC5ib2FyZFBvc2l0aW9uQXJyYXkuc3BsaWNlKHJhbmRvbU51bWJlciwgMSk7XHJcbiAgICAgICAgICAgIGlmKCEoc2hvdHNBcnJheUNvbXAuaW5jbHVkZXMocG9zKSkpey8vIG5vIGhpdHRpbmcgc2FtZSBwb3NpdGlvbiB0d2ljZVxyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3Bvc31gKTtcclxuICAgICAgICAgICAgICAgIHNob3RzQXJyYXlDb21wLnB1c2gocG9zKTsvLyBwdXNoaW5nIGhpdCBwb3NpdGlvbiB0byBhcnJheVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2hpcEFycmF5ID0gcGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheTtcclxuICAgICAgICAgICAgICAgIGlmKHNoaXBBcnJheS5pbmNsdWRlcyhwb3MpKXsvLyBpZiBzaGlwIGdldHMgaGl0IGRpdiBjb2xvciBjaGFuZ2VzIHRvIHJlZFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQXJyYXkuc3BsaWNlKHNoaXBBcnJheS5pbmRleE9mKHBvcyksMSk7IC8vIHJlbW92ZXMgcG9zaXRpb24gZnJvbSBzaGlwQXJyYXlcclxuICAgICAgICAgICAgICAgICAgICBpZihjaGVja0dhbWVFbmQocGxheWVyKSkgcmV0dXJuIDA7Ly8gaWYgZ2FtZSBlbmRzIG5vIHN3aXRjaGluZyB0dXJuc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXsvLyBpZiBub3QgaGl0IGRpdiBjaG5hZ2VzIHRvIHllbGxvd1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGNoYW5nZXMgdHVybiB0byBvdGhlciBwbGF5ZXJcclxuICAgICAgICAgICAgICAgIHBsYXllck9uZS5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTtcclxuICAgICAgICAgICAgICAgIHBsYXllclR3by5jbGFzc0xpc3QucmVtb3ZlKFwidHVyblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmlkSXRlbUNvbXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXllci0yIC5ncmlkLWl0ZW1cIik7XHJcbiAgICBncmlkSXRlbUNvbXAuZm9yRWFjaCgoaXRlbSk9PntcclxuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKT0+e1xyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwYXJzZUZsb2F0KGl0ZW0uaWQpO1xyXG4gICAgICAgICAgICBpZighKHNob3RzQXJyYXkuaW5jbHVkZXMocG9zKSkpey8vIGNhbid0IGhpdCBzYW1lIHBvc2l0aW9uIHR3aWNlXHJcbiAgICAgICAgICAgICAgICBzaG90c0FycmF5LnB1c2gocG9zKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBBcnJheSA9IGNvbXB1dGVyLmJvYXJkLmhhc1NoaXBBcnJheTtcclxuICAgICAgICAgICAgICAgIGlmKHNoaXBBcnJheS5pbmNsdWRlcyhwb3MpKXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7Ly8gaGl0IHNpZ25hbGxpbmdcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQXJyYXkuc3BsaWNlKHNoaXBBcnJheS5pbmRleE9mKHBvcyksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY2hlY2tHYW1lRW5kKGNvbXB1dGVyKSkgcmV0dXJuIDA7Ly8gaWYgZ2FtZSBlbmRzIG5vIHN3aXRjaGluZyB0dXJuc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0dXJuIHN3aXRjaGluZ1xyXG4gICAgICAgICAgICAgICAgcGxheWVyVHdvLmNsYXNzTGlzdC5hZGQoXCJ0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyT25lLmNsYXNzTGlzdC5yZW1vdmUoXCJ0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gY29tcHV0ZXIgYXR0YWNrcyBhZnRlciAxIHNlY1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZXJQbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxufSIsIi8qIGVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcbmltcG9ydCBTaGlwcyBmcm9tIFwiLi4vbW9kdWxlcy9zaGlwXCI7XHJcbmltcG9ydCB7IHBsYXllciwgc3RhcnRHYW1lIH0gZnJvbSBcIi4vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc29tZUZ1bmN0aW9uKCl7XHJcbiAgICBjb25zdCBncmlkSXRlbVBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTEgLmdyaWQtaXRlbVwiKTtcclxuICAgIGNvbnN0IHJvdGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucm90YXRlXCIpO1xyXG4gICAgbGV0IGRpcmVjdGlvbiA9IDE7XHJcbiAgICByb3RhdGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSAxKXtcclxuICAgICAgICAgICAgZGlyZWN0aW9uID0gMTA7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIGxldCBqID0gNTtcclxuICAgIGxldCBjb3VudCA9MDtcclxuICAgIGNvbnN0IGFsbHRoaXMgPSAoKT0+e1xyXG4gICAgICAgIGdyaWRJdGVtUGxheWVyLmZvckVhY2goKGdyaWQpPT57XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIgXCI7XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgcmVkXCJcclxuICAgICAgICAgICAgaWYocGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhwYXJzZUludChncmlkLmlkLCAxMCkpKVxyXG4gICAgICAgICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJncmVlblwiKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+e1xyXG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBuZXdBcnJheSA9IFtdXHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGo7aSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FycmF5RWxlbWVudCA9IHBhcnNlSW50KGdyaWQuaWQsIDEwKSsoaSpkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgbmV3QXJyYXkucHVzaChuZXdBcnJheUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCEocGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkpXHJcbiAgICAgICAgICAgIGlmKCEocGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgY29uc3QgcGxheWVyU2hpcCA9IG5ldyBTaGlwcyhgc2hpcC0ke2NvdW50fWAsIGosIG5ld0FycmF5KVxyXG4gICAgICAgICAgICBwbGF5ZXIuc2hpcHMucHVzaChwbGF5ZXJTaGlwKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocGxheWVyKVxyXG4gICAgICAgICAgICBhbGx0aGlzKCk7XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGlmKGNvdW50ID09PSA1KSBzdGFydEdhbWUuY2xpY2soKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIHJldHVybiAwO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpPT57XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPCBqOyBpKyspe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JpZExpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwYXJzZUludChncmlkLmlkLCAxMCkrKGkqZGlyZWN0aW9uKX1gKTtcclxuICAgICAgICAgICAgICAgIGlmKGdyaWRMaW5lLmNsYXNzTGlzdFsxXSA9PT0gXCJncmVlblwiKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBncmlkTGluZS5zdHlsZS5ib3JkZXIgPSBcIjJweCBzb2xpZCBncmVlblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIycHggc29saWQgZ3JlZW5cIjtcclxuICAgICAgICB9KTtcclxuICAgICAgICBncmlkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIsICgpPT57XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDE7IGkgPCA1OyBpKyspe1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZ3JpZExpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwYXJzZUludChncmlkLmlkLCAxMCkrKGkqZGlyZWN0aW9uKX1gKTtcclxuICAgICAgICAgICAgICAgIGlmKGdyaWRMaW5lLmNsYXNzTGlzdFsxXSA9PT0gXCJncmVlblwiKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBncmlkTGluZS5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCByZWRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJuYW1lIiwidGhpcyIsInNoaXBzIiwiYm9hcmQiLCJib2FyZFBvc2l0aW9uQXJyYXkiLCJoYXNTaGlwQXJyYXkiLCJib2FyZENyZWF0ZSIsImkiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsInBvcyIsImluY2x1ZGVzIiwic3BsaWNlIiwiY2hlY2tpbmdJZkhpdCIsImluZGV4T2YiLCJnYW1lRW5kIiwibGVuZ3RoIiwic2hpcHNQbGFjZW1lbnQiLCJzaGlwc0FyciIsInNob3J0ZWRTaGlwc0FyciIsInNvcnQiLCJhIiwiYiIsImJvcmRlckhvcml6b250YWwiLCJib3JkZXJWZXJ0aWNhbCIsImV2ZXJ5IiwiZWxlbSIsIlNoaXBzIiwicG9zaXRpb24iLCJoaXRzIiwiaGFzU3Vua2VuIiwiaGl0IiwiaXNTdW5rIiwiY29tcHV0ZXIiLCJzdGFydEdhbWUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJtYWtlUm93cyIsImRpdiIsInJvd3MiLCJjb2xzIiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsImMiLCJjZWxsIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY2xhc3NMaXN0IiwiYWRkIiwiaWQiLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iLCJnZXRSYW5kb21MZWdhbFBvc2l0aW9uIiwiaiIsInBlcnNvbiIsInJhbmRvbU51bWJlciIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm5ld0FycmF5IiwiYWRkaW5nQXJyYXkiLCJhZGRpbmdEaWdpdCIsInJhbmRvbWlzZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJncmlkSXRlbVBsYXllciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZ3JpZCIsImJhY2tncm91bmRDb2xvciIsInBsYXllclNoaXAiLCJwYXJzZUludCIsInBsYXllclNoaXBzIiwicG9pbnRlckV2ZW50cyIsImNvbXBTaGlwIiwiY29tcHV0ZXJTaGlwcyIsImRpc2FibGVkIiwicmVtb3ZlIiwiY2hlY2tHYW1lRW5kIiwiY29uc29sZSIsImxvZyIsInNob3RzQXJyYXkiLCJzaG90c0FycmF5Q29tcCIsIml0ZW0iLCJwYXJzZUZsb2F0Iiwic2hpcEFycmF5Iiwic2V0VGltZW91dCIsImdldEVsZW1lbnRCeUlkIiwiY29tcHV0ZXJQbGF5IiwiaGl0Qm9hcmQiLCJyb3RhdGUiLCJkaXJlY3Rpb24iLCJjb3VudCIsIm5ld0FycmF5RWxlbWVudCIsImJvcmRlciIsImNsaWNrIiwiZ3JpZExpbmUiLCJzb21lRnVuY3Rpb24iXSwic291cmNlUm9vdCI6IiJ9