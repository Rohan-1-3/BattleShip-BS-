(()=>{"use strict";const e=class{constructor(e){this.name=e,this.ships=[],this.board=new class{constructor(){this.boardPositionArray=[],this.hasShipArray=[],this.boardCreate()}boardCreate(){for(let e=0;e<100;e++)this.boardPositionArray.push(e)}receiveAttack(e){return this.boardPositionArray.includes(e)?(this.boardPositionArray.includes(e)&&this.boardPositionArray.splice(e,1),this.checkingIfHit(e)):"out of the box"}checkingIfHit(e){return!!this.hasShipArray.includes(e)&&(this.hasShipArray.splice(this.hasShipArray.indexOf(e),1),!0)}gameEnd(){return!(0!==this.hasShipArray.length)}shipsPlacement(e){const r=e.sort(((e,r)=>e-r)),t=[9,19,29,39,49,59,69,79,89,99],s=[90,91,92,93,94,95,96,97,98,99];for(let o=0;o<r.length-1;o++){if(e[o]<0)return!1;if(!this.boardPositionArray.includes(r[o]))return!1;if(this.hasShipArray.includes(e[o]))return!1;if(this.hasShipArray.includes(e[r.length-1]))return!1;if(r[o+1]-r[o]!=1&&r[o+1]-r[o]!=10)return!1;if(t.includes(r[o])||s.includes(r[o])){if(e.every((e=>t.includes(e)||s.includes(e))))break;if(o!==r.length||0!==o)return!1}}return this.hasShipArray.push(...r),!0}}}};class r{constructor(e,r,t,s=0){this.name=e,this.length=r,this.position=t,this.hits=s,this.hasSunken=!1}hit(e){this.position.splice(this.position.indexOf(e),1),this.hits++,this.isSunk(this.hits)}isSunk(){0===this.position.length&&(this.hasSunken=!0)}}const t=new e("player"),s=new e("computer"),o=document.querySelector(".game-start");!function(){!function(){function e(e,r=10,t=10){e.style.setProperty("--grid-rows",r),e.style.setProperty("--grid-cols",t);for(let s=0;s<r*t;s++){const r=document.createElement("div");e.appendChild(r),r.classList.add("grid-item"),r.id=s}}const r=document.querySelector(".player-1"),t=document.querySelector(".player-2");e(r),e(t)}();const e=(r,t)=>{const s=Math.floor(100*Math.random()),o=[],i=[1,10,1,10,10,1,10,1],n=i[Math.floor(Math.random()*i.length)];for(let e=0;e<r;e++)o.push(s+e*n);return t.board.shipsPlacement(o)?o:e(r,t)},i=document.querySelector(".player-1"),n=document.querySelector(".player-2");n.classList.add("turn");const a=document.querySelector(".randomPlayer");a.addEventListener("click",(()=>{(()=>{t.ships=[],t.board.hasShipArray=[];const s=document.querySelectorAll(".player-1 .grid-item");s.forEach((e=>{e.style.backgroundColor="white"}));let o=5;for(let s=0;s<5;s++){const i=new r(`ship${s}`,o,e(o,t));t.ships.push(i),2!==o&&o--}for(let e=0;e<5;e++)0===e&&(t.board.hasShipArray=[]),t.board.shipsPlacement(t.ships[e].position);s.forEach((e=>{t.board.hasShipArray.includes(parseInt(e.id,10))&&(e.style.backgroundColor="green")}))})()})),o.addEventListener("click",(()=>{i.style.pointerEvents="none",(()=>{document.querySelector(".player-1").classList.add("turn");let t=5;for(let o=0;o<5;o++){const i=new r(`ship${o}`,t,e(t,s));s.ships.push(i),2!==t&&t--}for(let e=0;e<5;e++)0===e&&(s.board.hasShipArray=[]),s.board.shipsPlacement(s.ships[e].position)})(),a.disabled=!0,o.disabled=!0,n.classList.remove("turn")}))}(),function(){const e=e=>0===e.board.hasShipArray.length&&(document.querySelector(".game").style.pointerEvents="none",console.log(`${e.name} Lost`),!0),r=[],o=[],i=document.querySelector(".player-1"),n=document.querySelector(".player-2");document.querySelectorAll(".player-2 .grid-item").forEach((a=>{a.addEventListener("click",(()=>{const l=parseFloat(a.id);if(!r.includes(l)){r.push(l);const c=s.board.hasShipArray;if(c.includes(l)){if(a.style.backgroundColor="red",c.splice(c.indexOf(l),1),e(s))return 0}else a.style.backgroundColor="yellow";n.classList.add("turn"),i.classList.remove("turn"),setTimeout((()=>{(()=>{const r=Math.floor(Math.random()*t.board.boardPositionArray.length),s=t.board.boardPositionArray[r];if(t.board.boardPositionArray.splice(r,1),!o.includes(s)){const r=document.getElementById(`${s}`);o.push(s);const a=t.board.hasShipArray;if(a.includes(s)){if(r.style.backgroundColor="red",a.splice(a.indexOf(s),1),e(t))return 0}else r.style.backgroundColor="yellow";i.classList.add("turn"),n.classList.remove("turn")}})()}),1e3)}return 0}))}))}(),function(){const e=document.querySelectorAll(".player-1 .grid-item"),s=document.querySelector(".rotate");let i=1;s.addEventListener("click",(()=>{i=1===i?10:1}));let n=5,a=0;e.forEach((s=>{s.addEventListener("click",(()=>{const l=[];for(let e=0;e<n;e++){const r=parseInt(s.id,10)+e*i;l.push(r)}if(!t.board.shipsPlacement(l))return!1;const c=new r(`ship-${a}`,n,l);return t.ships.push(c),console.log(t),e.forEach((e=>{e.style.backgroundColor=" ",e.style.border="1px solid red",t.board.hasShipArray.includes(parseInt(e.id,10))&&e.classList.add("green")})),a++,5===a&&o.click(),2===n?0:(n--,!0)})),s.addEventListener("mouseover",(()=>{for(let e=1;e<n;e++){const r=document.getElementById(`${parseInt(s.id,10)+e*i}`);if("green"===r.classList[1])return!1;r.style.border="2px solid green"}s.style.border="2px solid green"})),s.addEventListener("mouseleave",(()=>{for(let e=1;e<5;e++){const r=document.getElementById(`${parseInt(s.id,10)+e*i}`);if("green"===r.classList[1])return!1;r.style.border="1px solid red"}s.style.border="1px solid red"}))}))}()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aEIsU0FBU0gsRUFBS2xCLEdBQUksSUFBSzFDLEVBQUVtRixLQUNyRSxHQUE2QixVQUExQkssRUFBU2hELFVBQVUsR0FBZ0IsT0FBTyxFQUM3Q2dELEVBQVN0RCxNQUFNb0QsT0FBUyxpQkFDeEIsQ0FDQTFCLEVBQUsxQixNQUFNb0QsT0FBUyxpQkFBaUIsSUFFekMxQixFQUFLSixpQkFBaUIsY0FBYyxLQUVoQyxJQUFJLElBQUl4RCxFQUFJLEVBQUdBLEVBQUksRUFBR0EsSUFBSSxDQUN0QixNQUFNd0YsRUFBVzVELFNBQVNtRCxlQUFlLEdBQUdoQixTQUFTSCxFQUFLbEIsR0FBSSxJQUFLMUMsRUFBRW1GLEtBQ3JFLEdBQTZCLFVBQTFCSyxFQUFTaEQsVUFBVSxHQUFnQixPQUFPLEVBQzdDZ0QsRUFBU3RELE1BQU1vRCxPQUFTLGVBQzVCLENBRUExQixFQUFLMUIsTUFBTW9ELE9BQVMsZUFBZSxHQUNyQyxHQUVWLENGN0RBRyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL2dhbWVCb2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL3NoaXBQbGFjZW1lbnQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ3JlYXRpb24vZ2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ3JlYXRpb24vaGl0R2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZUNyZWF0aW9uL21hbnVhbFNoaXBzUGxhY2VtZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEdhbWVCb2FyZHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkgPSBbXTtcclxuICAgICAgICB0aGlzLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgIHRoaXMuYm9hcmRDcmVhdGUoKTsvLyBpbnN0YW50bHkgY3JlYXRlcyBhIGJvYXJkXHJcbiAgICB9XHJcblxyXG4gICAgYm9hcmRDcmVhdGUoKXtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2k8MTAwO2krKyl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnB1c2goaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlY2VpdmVBdHRhY2socG9zKXsvLyByZWNlaXZlcyBhdHRhY2sgYW5kIG1hcmtzIGlmIGhpdCBvciBtaXNzXHJcbiAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHBvcykpIHJldHVybiBcIm91dCBvZiB0aGUgYm94XCI7XHJcbiAgICAgICAgaWYodGhpcy5ib2FyZFBvc2l0aW9uQXJyYXkuaW5jbHVkZXMocG9zKSl7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LnNwbGljZShwb3MsMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoZWNraW5nSWZIaXQocG9zKTtcclxuICAgIH1cclxuXHJcbiAgICBjaGVja2luZ0lmSGl0KHBvcyl7XHJcbiAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMocG9zKSl7Ly8gY2hlY2tpbmcgaGl0LCBpZiBoaXQgcmVtb3ZlcyBibG9jayBmcm9tIHNoaXBBcnJheVxyXG4gICAgICAgICAgICB0aGlzLmhhc1NoaXBBcnJheS5zcGxpY2UodGhpcy5oYXNTaGlwQXJyYXkuaW5kZXhPZihwb3MpLDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGdhbWVFbmQoKXsvLyBjaGVjayBpZiBhbGwgc2hpcHMgc3Vua1xyXG4gICAgICAgIHJldHVybiAhISh0aGlzLmhhc1NoaXBBcnJheS5sZW5ndGggPT09IDApO1xyXG4gICAgfVxyXG5cclxuICAgIHNoaXBzUGxhY2VtZW50KHNoaXBzQXJyKXtcclxuICAgICAgICBjb25zdCBzaG9ydGVkU2hpcHNBcnIgPSBzaGlwc0Fyci5zb3J0KChhLCBiKSA9PmEgLSBiKTsvLyBzb3J0aW5nXHJcbiAgICAgICAgLy8gYm9yZGVyIG9mIHRoZSBib2FyZFxyXG4gICAgICAgIGNvbnN0IGJvcmRlckhvcml6b250YWwgPSBbOSwxOSwyOSwzOSw0OSw1OSw2OSw3OSw4OSw5OV07XHJcbiAgICAgICAgY29uc3QgYm9yZGVyVmVydGljYWwgPSBbOTAsOTEsOTIsOTMsOTQsOTUsOTYsOTcsOTgsOTldO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoLTE7aSsrKXtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGJleW9uZCBib2FyZFxyXG4gICAgICAgICAgICBpZihzaGlwc0FycltpXTwwKSByZXR1cm4gZmFsc2U7XHJcbiAgICBcclxuICAgICAgICAgICAgaWYoIXRoaXMuYm9hcmRQb3NpdGlvbkFycmF5LmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxhcHBpbmcgb2Ygc2hpcHNcclxuICAgICAgICAgICAgaWYodGhpcy5oYXNTaGlwQXJyYXkuaW5jbHVkZXMoc2hpcHNBcnJbaV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmKHRoaXMuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHNoaXBzQXJyW3Nob3J0ZWRTaGlwc0Fyci5sZW5ndGgtMV0pKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vIHBsYWNlbWVudCBpbiByYW5kb20gb3JkZXJcclxuICAgICAgICAgICAgaWYoISgoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxIFxyXG4gICAgICAgICAgICB8fCAoc2hvcnRlZFNoaXBzQXJyW2krMV0gLSBzaG9ydGVkU2hpcHNBcnJbaV0pID09PSAxMCkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgLy8gcGxhY2VtZW50IGNyb3NzZXMgdGhlIHZlcnRpY2FsIGFuZCBob3Jpem9udG9sIGJvcmRlclxyXG4gICAgICAgICAgICBpZihib3JkZXJIb3Jpem9udGFsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkgXHJcbiAgICAgICAgICAgIHx8IGJvcmRlclZlcnRpY2FsLmluY2x1ZGVzKHNob3J0ZWRTaGlwc0FycltpXSkpe1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZihzaGlwc0Fyci5ldmVyeShlbGVtID0+IGJvcmRlckhvcml6b250YWwuaW5jbHVkZXMoZWxlbSkgXHJcbiAgICAgICAgICAgICAgICB8fCBib3JkZXJWZXJ0aWNhbC5pbmNsdWRlcyhlbGVtKSkpIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgaWYoIShpID09PSBzaG9ydGVkU2hpcHNBcnIubGVuZ3RoICYmIGkgPT09IDApKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gYWRkcyBzaGlwIHRvIGZyZXNoIGxvY2F0aW9uXHJcbiAgICAgICAgdGhpcy5oYXNTaGlwQXJyYXkucHVzaCguLi5zaG9ydGVkU2hpcHNBcnIpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBHYW1lQm9hcmQiLCJpbXBvcnQgR2FtZUJvYXJkIGZyb20gXCIuL2dhbWVCb2FyZFwiO1xyXG5cclxuY2xhc3MgUGxheWVye1xyXG4gICAgY29uc3RydWN0b3IobmFtZSl7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnNoaXBzID0gW107XHJcbiAgICAgICAgdGhpcy5ib2FyZCA9IG5ldyBHYW1lQm9hcmQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFBsYXllciIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoaXBze1xyXG4gICAgY29uc3RydWN0b3IobmFtZSxsZW5ndGgscG9zaXRpb24sIGhpdHMgPSAwKXtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xyXG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuICAgICAgICB0aGlzLmhpdHMgPSBoaXRzO1xyXG4gICAgICAgIHRoaXMuaGFzU3Vua2VuID0gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgaGl0KHBvc2l0aW9uKXsvLyBoaXRzIHRoZSBwb3NpdGlvbiBhbmQgcmVtb3ZlcyB0aGUgcG9zaXRpb24gZnJvbSB0aGUgYXJyYXlcclxuICAgICAgICB0aGlzLnBvc2l0aW9uLnNwbGljZSh0aGlzLnBvc2l0aW9uLmluZGV4T2YocG9zaXRpb24pLDEpO1xyXG4gICAgICAgIHRoaXMuaGl0cysrO1xyXG4gICAgICAgIHRoaXMuaXNTdW5rKHRoaXMuaGl0cyk7XHJcbiAgICB9XHJcblxyXG4gICAgaXNTdW5rKCl7Ly8gb25jZSBhbGwgaGl0IGl0IHNpbmtzXHJcbiAgICAgICAgaWYodGhpcy5wb3NpdGlvbi5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5oYXNTdW5rZW4gPSB0cnVlO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby1jb250aW51ZSAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xyXG5pbXBvcnQgUGxheWVyIGZyb20gXCIuLi9tb2R1bGVzL3BsYXllclwiXHJcbmltcG9ydCBTaGlwcyBmcm9tIFwiLi4vbW9kdWxlcy9zaGlwXCJcclxuaW1wb3J0IGdhbWVCb2FyZCBmcm9tIFwiLi9nYW1lQm9hcmRcIjtcclxuXHJcbi8vIHR3byBuZXcgcGxheWVycyBjcmVhdGVkXHJcbmNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoXCJwbGF5ZXJcIik7XHJcbmNvbnN0IGNvbXB1dGVyID0gbmV3IFBsYXllcihcImNvbXB1dGVyXCIpO1xyXG5jb25zdCBzdGFydEdhbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWUtc3RhcnRcIik7XHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHNoaXBzKCl7XHJcbiAgICBnYW1lQm9hcmQoKTsvLyBib3ggYXJlYSBmb3IgYm90aCBwbGF5ZXJzXHJcblxyXG4gICAgY29uc3QgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbiA9IChqLCBwZXJzb24pPT57XHJcbiAgICAgICAgY29uc3QgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKTtcclxuICAgICAgICBjb25zdCBuZXdBcnJheSA9IFtdO1xyXG4gICAgICAgIGNvbnN0IGFkZGluZ0FycmF5ID0gWzEsMTAsMSwxMCwxMCwxLDEwLDFdO1xyXG4gICAgICAgIGNvbnN0IGFkZGluZ0RpZ2l0ID0gYWRkaW5nQXJyYXlbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmFkZGluZ0FycmF5Lmxlbmd0aCldO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGo7aSsrKXtcclxuICAgICAgICAgICAgbmV3QXJyYXkucHVzaChyYW5kb21OdW1iZXIrKGkgKiBhZGRpbmdEaWdpdCkpOy8vIGEgcmFuZG9tIG51bWJlciBhbmQgbWFrZSBhIHNlcmlhbGlzZWQgYXJyYXkgb2YgaXRcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocGVyc29uLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkgcmV0dXJuIG5ld0FycmF5Oy8vIGlmIHBsYWNlbWVudCBpdCBjb3JyZWN0IHJldHVybnNcclxuICAgICAgICByZXR1cm4gZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBwZXJzb24pOy8vIGlmIG5vdCByZWN1cnNpdmUgZnVuY3Rpb25cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwbGF5ZXJTaGlwcyA9ICgpPT57Ly8gY3JlYXRlcyBzaGlwcyBmb3IgcGxheWVyIGF0IHJhbmRvbSBwbGFjZXNcclxuICAgICAgICBwbGF5ZXIuc2hpcHMgPSBbXTtcclxuICAgICAgICBwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5ID0gW107XHJcbiAgICAgICAgY29uc3QgZ3JpZEl0ZW1QbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXllci0xIC5ncmlkLWl0ZW1cIik7XHJcbiAgICAgICAgZ3JpZEl0ZW1QbGF5ZXIuZm9yRWFjaCgoZ3JpZCk9PntcclxuICAgICAgICAgICAgZ3JpZC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBcIndoaXRlXCI7XHJcbiAgICAgICAgfSlcclxuICAgICAgICBsZXQgaiA9IDU7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgNTtpKyspe1xyXG4gICAgICAgICAgICBjb25zdCBwbGF5ZXJTaGlwID0gbmV3IFNoaXBzKGBzaGlwJHtpfWAsaiwgZ2V0UmFuZG9tTGVnYWxQb3NpdGlvbihqLCBwbGF5ZXIpKTtcclxuICAgICAgICAgICAgcGxheWVyLnNoaXBzLnB1c2gocGxheWVyU2hpcCk7XHJcbiAgICAgICAgICAgIC8vIG5vIHNoaXBzIGxlc3MgdGhhbiAyIGluIHNpemVcclxuICAgICAgICAgICAgaWYoaiA9PT0gMikgY29udGludWU7XHJcbiAgICAgICAgICAgIGotLTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvcihsZXQgaSA9MDsgaTw1O2krKyl7XHJcbiAgICAgICAgICAgIGlmKGk9PT0wKSBwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5ID0gW107Ly8gY2xlYXJpbmcgdGhlIHNoaXAgYXJyYXlcclxuICAgICAgICAgICAgcGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KHBsYXllci5zaGlwc1tpXS5wb3NpdGlvbik7Ly8gZmlsbGluZyBpdCB3aXRoIHByb3BlciBwbGFjZW1lbnRzXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+ey8vIHNob3dpbmcgdGhlIHBsYXllcidzIHNoaXAgbG9jYXRpb25cclxuICAgICAgICBpZihwbGF5ZXIuYm9hcmQuaGFzU2hpcEFycmF5LmluY2x1ZGVzKHBhcnNlSW50KGdyaWQuaWQsIDEwKSkpe1xyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiZ3JlZW5cIjtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb21wdXRlclNoaXBzID0gKCk9PntcclxuICAgICAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgICAgIHBsYXllck9uZS5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTsgLy8gZGlzYmFsaW5nIERPTSBmb3Igb3Bwb3NpdGUgcGxheWVyXHJcbiAgICAgICAgbGV0IGogPSA1O1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDU7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgY29tcFNoaXAgPSBuZXcgU2hpcHMoYHNoaXAke2l9YCxqLCBnZXRSYW5kb21MZWdhbFBvc2l0aW9uKGosIGNvbXB1dGVyKSlcclxuICAgICAgICAgICAgY29tcHV0ZXIuc2hpcHMucHVzaChjb21wU2hpcCk7XHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IobGV0IGkgPTAgOyBpPDU7aSsrKXtcclxuICAgICAgICAgICAgaWYoaT09PTApIGNvbXB1dGVyLmJvYXJkLmhhc1NoaXBBcnJheSA9IFtdO1xyXG4gICAgICAgICAgICBjb21wdXRlci5ib2FyZC5zaGlwc1BsYWNlbWVudChjb21wdXRlci5zaGlwc1tpXS5wb3NpdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIHBsYXllclR3by5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTtcclxuICAgIC8vIGNyZWF0aW5nIHNoaXBzIHJhbmRvbWx5XHJcbiAgICBjb25zdCByYW5kb21pc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJhbmRvbVBsYXllclwiKTtcclxuICAgIHJhbmRvbWlzZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBwbGF5ZXJTaGlwcygpO1xyXG4gICAgfSlcclxuICAgIHN0YXJ0R2FtZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCk9PntcclxuICAgICAgICBwbGF5ZXJPbmUuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xyXG4gICAgICAgIGNvbXB1dGVyU2hpcHMoKTtcclxuICAgICAgICByYW5kb21pc2UuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIHN0YXJ0R2FtZS5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgcGxheWVyVHdvLmNsYXNzTGlzdC5yZW1vdmUoXCJ0dXJuXCIpXHJcbiAgICB9KVxyXG4gICAgXHJcbn1cclxuXHJcbmV4cG9ydCB7cGxheWVyLCBjb21wdXRlciwgc3RhcnRHYW1lfSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdhbWVCb2FyZCgpe1xyXG4gICAgZnVuY3Rpb24gbWFrZVJvd3MoZGl2LHJvd3MgPSAxMCwgY29scz0xMCkge1xyXG4gICAgICAgIGRpdi5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZ3JpZC1yb3dzXCIsIHJvd3MpO1xyXG4gICAgICAgIGRpdi5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tZ3JpZC1jb2xzXCIsIGNvbHMpO1xyXG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgKHJvd3MgKiBjb2xzKTsgYysrKSB7XHJcbiAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgIGRpdi5hcHBlbmRDaGlsZChjZWxsKTtcclxuICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZChcImdyaWQtaXRlbVwiKTtcclxuICAgICAgICAgIGNlbGwuaWQgPSBjO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCBwbGF5ZXJPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0xXCIpO1xyXG4gICAgY29uc3QgcGxheWVyVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItMlwiKTtcclxuICAgIC8vIGNyZWF0ZXMgMTB4MTAgYm94IGZvciBib3RoIHBsYXllcnNcclxuICAgIG1ha2VSb3dzKHBsYXllck9uZSk7XHJcbiAgICBtYWtlUm93cyhwbGF5ZXJUd28pO1xyXG59IiwiaW1wb3J0IGhpdEJvYXJkIGZyb20gXCIuL2dhbWVDcmVhdGlvbi9oaXRHYW1lQm9hcmRcIjtcclxuaW1wb3J0IHNvbWVGdW5jdGlvbiBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vbWFudWFsU2hpcHNQbGFjZW1lbnRcIjtcclxuaW1wb3J0IHNoaXBzICBmcm9tIFwiLi9nYW1lQ3JlYXRpb24vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuXHJcbnNoaXBzKCk7XHJcbmhpdEJvYXJkKCk7XHJcbnNvbWVGdW5jdGlvbigpO1xyXG5cclxuXHJcbiIsIi8qIGVzbGludC1kaXNhYmxlIGltcG9ydC9uby1jeWNsZSAqL1xyXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xyXG5pbXBvcnQgeyBjb21wdXRlciwgcGxheWVyIH0gZnJvbSBcIi4vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gaGl0Qm9hcmQoKXtcclxuXHJcbiAgICBjb25zdCBjaGVja0dhbWVFbmQgPSAocGVyc29uKT0+e1xyXG4gICAgICAgIGlmKHBlcnNvbi5ib2FyZC5oYXNTaGlwQXJyYXkubGVuZ3RoID09PSAwKXtcclxuICAgICAgICAgICAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZ2FtZVwiKTtcclxuICAgICAgICAgICAgbWFpbi5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7IC8vIGFmdGVyIGdhbWUgZW5kcyBET00gYWxsb3dlZFxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgJHtwZXJzb24ubmFtZX0gTG9zdGApOyAvLyBpZGlzcGxheXNcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYXJyYXkgZm9yIHJlY29yZGluZyBzaG90c1xyXG4gICAgY29uc3Qgc2hvdHNBcnJheSA9IFtdO1xyXG4gICAgY29uc3Qgc2hvdHNBcnJheUNvbXAgPSBbXTtcclxuICAgIGNvbnN0IHBsYXllck9uZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLTFcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci0yXCIpO1xyXG4gIFxyXG4gICAgXHJcblxyXG4gICAgY29uc3QgY29tcHV0ZXJQbGF5ID0gKCk9PnsvLyByYW5kb20gY29tcHV0ZXIgcGxheXNcclxuICAgICAgICBjb25zdCByYW5kb21OdW1iZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqcGxheWVyLmJvYXJkLmJvYXJkUG9zaXRpb25BcnJheS5sZW5ndGgpXHJcbiAgICAgICAgY29uc3QgcG9zID0gcGxheWVyLmJvYXJkLmJvYXJkUG9zaXRpb25BcnJheVtyYW5kb21OdW1iZXJdO1xyXG4gICAgICAgIC8vIHJlbW92ZXMgdGhlIHBvc2l0aW9uIGZyb20gcGxheWVycyBib2FyZCBhZnRlciBzaG90c1xyXG4gICAgICAgIHBsYXllci5ib2FyZC5ib2FyZFBvc2l0aW9uQXJyYXkuc3BsaWNlKHJhbmRvbU51bWJlciwgMSk7XHJcbiAgICAgICAgICAgIGlmKCEoc2hvdHNBcnJheUNvbXAuaW5jbHVkZXMocG9zKSkpey8vIG5vIGhpdHRpbmcgc2FtZSBwb3NpdGlvbiB0d2ljZVxyXG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3Bvc31gKTtcclxuICAgICAgICAgICAgICAgIHNob3RzQXJyYXlDb21wLnB1c2gocG9zKTsvLyBwdXNoaW5nIGhpdCBwb3NpdGlvbiB0byBhcnJheVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgc2hpcEFycmF5ID0gcGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheTtcclxuICAgICAgICAgICAgICAgIGlmKHNoaXBBcnJheS5pbmNsdWRlcyhwb3MpKXsvLyBpZiBzaGlwIGdldHMgaGl0IGRpdiBjb2xvciBjaGFuZ2VzIHRvIHJlZFxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJyZWRcIjtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQXJyYXkuc3BsaWNlKHNoaXBBcnJheS5pbmRleE9mKHBvcyksMSk7IC8vIHJlbW92ZXMgcG9zaXRpb24gZnJvbSBzaGlwQXJyYXlcclxuICAgICAgICAgICAgICAgICAgICBpZihjaGVja0dhbWVFbmQocGxheWVyKSkgcmV0dXJuIDA7Ly8gaWYgZ2FtZSBlbmRzIG5vIHN3aXRjaGluZyB0dXJuc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXsvLyBpZiBub3QgaGl0IGRpdiBjaG5hZ2VzIHRvIHllbGxvd1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCJ5ZWxsb3dcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIGNoYW5nZXMgdHVybiB0byBvdGhlciBwbGF5ZXJcclxuICAgICAgICAgICAgICAgIHBsYXllck9uZS5jbGFzc0xpc3QuYWRkKFwidHVyblwiKTtcclxuICAgICAgICAgICAgICAgIHBsYXllclR3by5jbGFzc0xpc3QucmVtb3ZlKFwidHVyblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmlkSXRlbUNvbXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXllci0yIC5ncmlkLWl0ZW1cIik7XHJcbiAgICBncmlkSXRlbUNvbXAuZm9yRWFjaCgoaXRlbSk9PntcclxuICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKT0+e1xyXG4gICAgICAgICAgICBjb25zdCBwb3MgPSBwYXJzZUZsb2F0KGl0ZW0uaWQpO1xyXG4gICAgICAgICAgICBpZighKHNob3RzQXJyYXkuaW5jbHVkZXMocG9zKSkpey8vIGNhbid0IGhpdCBzYW1lIHBvc2l0aW9uIHR3aWNlXHJcbiAgICAgICAgICAgICAgICBzaG90c0FycmF5LnB1c2gocG9zKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBBcnJheSA9IGNvbXB1dGVyLmJvYXJkLmhhc1NoaXBBcnJheTtcclxuICAgICAgICAgICAgICAgIGlmKHNoaXBBcnJheS5pbmNsdWRlcyhwb3MpKXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwicmVkXCI7Ly8gaGl0IHNpZ25hbGxpbmdcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQXJyYXkuc3BsaWNlKHNoaXBBcnJheS5pbmRleE9mKHBvcyksMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoY2hlY2tHYW1lRW5kKGNvbXB1dGVyKSkgcmV0dXJuIDA7Ly8gaWYgZ2FtZSBlbmRzIG5vIHN3aXRjaGluZyB0dXJuc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwieWVsbG93XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB0dXJuIHN3aXRjaGluZ1xyXG4gICAgICAgICAgICAgICAgcGxheWVyVHdvLmNsYXNzTGlzdC5hZGQoXCJ0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgcGxheWVyT25lLmNsYXNzTGlzdC5yZW1vdmUoXCJ0dXJuXCIpO1xyXG4gICAgICAgICAgICAgICAgLy8gY29tcHV0ZXIgYXR0YWNrcyBhZnRlciAxIHNlY1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tcHV0ZXJQbGF5KCk7XHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxufSIsIi8qIGVzbGludC1kaXNhYmxlIGNvbnNpc3RlbnQtcmV0dXJuICovXHJcbi8qIGVzbGludC1kaXNhYmxlIG5vLXBhcmFtLXJlYXNzaWduICovXHJcbmltcG9ydCBTaGlwcyBmcm9tIFwiLi4vbW9kdWxlcy9zaGlwXCI7XHJcbmltcG9ydCB7IHBsYXllciwgc3RhcnRHYW1lIH0gZnJvbSBcIi4vc2hpcFBsYWNlbWVudFwiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc29tZUZ1bmN0aW9uKCl7XHJcbiAgICBjb25zdCBncmlkSXRlbVBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGxheWVyLTEgLmdyaWQtaXRlbVwiKTtcclxuICAgIGNvbnN0IHJvdGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucm90YXRlXCIpO1xyXG4gICAgbGV0IGRpcmVjdGlvbiA9IDE7XHJcbiAgICByb3RhdGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSAxKXtcclxuICAgICAgICAgICAgZGlyZWN0aW9uID0gMTA7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxuICAgIGxldCBqID0gNTtcclxuICAgIGxldCBjb3VudCA9MDtcclxuICAgIGNvbnN0IGFsbHRoaXMgPSAoKT0+e1xyXG4gICAgICAgIGdyaWRJdGVtUGxheWVyLmZvckVhY2goKGdyaWQpPT57XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gXCIgXCI7XHJcbiAgICAgICAgICAgIGdyaWQuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgcmVkXCJcclxuICAgICAgICAgICAgaWYocGxheWVyLmJvYXJkLmhhc1NoaXBBcnJheS5pbmNsdWRlcyhwYXJzZUludChncmlkLmlkLCAxMCkpKVxyXG4gICAgICAgICAgICBncmlkLmNsYXNzTGlzdC5hZGQoXCJncmVlblwiKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBncmlkSXRlbVBsYXllci5mb3JFYWNoKChncmlkKT0+e1xyXG4gICAgICAgIGdyaWQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT57XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjb25zdCBuZXdBcnJheSA9IFtdXHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGo7aSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG5ld0FycmF5RWxlbWVudCA9IHBhcnNlSW50KGdyaWQuaWQsIDEwKSsoaSpkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgbmV3QXJyYXkucHVzaChuZXdBcnJheUVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCEocGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkpXHJcbiAgICAgICAgICAgIGlmKCEocGxheWVyLmJvYXJkLnNoaXBzUGxhY2VtZW50KG5ld0FycmF5KSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgY29uc3QgcGxheWVyU2hpcCA9IG5ldyBTaGlwcyhgc2hpcC0ke2NvdW50fWAsIGosIG5ld0FycmF5KVxyXG4gICAgICAgICAgICBwbGF5ZXIuc2hpcHMucHVzaChwbGF5ZXJTaGlwKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocGxheWVyKVxyXG4gICAgICAgICAgICBhbGx0aGlzKCk7XHJcbiAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgIGlmKGNvdW50ID09PSA1KSBzdGFydEdhbWUuY2xpY2soKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGogPT09IDIpIHJldHVybiAwO1xyXG4gICAgICAgICAgICBqLS07XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsICgpPT57XHJcbiAgICAgICAgICAgIC8vIGlmKGdyaWQuY2xhc3NMaXN0WzFdID09PSBcImdyZWVuXCIpIHJldHVybiBmYWxzZVxyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgajsgaSsrKXtcclxuICAgICAgICAgICAgY29uc3QgZ3JpZExpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtwYXJzZUludChncmlkLmlkLCAxMCkrKGkqZGlyZWN0aW9uKX1gKTtcclxuICAgICAgICAgICAgaWYoZ3JpZExpbmUuY2xhc3NMaXN0WzFdID09PSBcImdyZWVuXCIpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgZ3JpZExpbmUuc3R5bGUuYm9yZGVyID0gXCIycHggc29saWQgZ3JlZW5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJvcmRlciA9IFwiMnB4IHNvbGlkIGdyZWVuXCI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZ3JpZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKT0+e1xyXG4gICAgICAgICAgICAvLyBpZihncmlkLmNsYXNzTGlzdFsxXSA9PT0gXCJncmVlblwiKSByZXR1cm4gZmFsc2VcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IDU7IGkrKyl7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBncmlkTGluZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3BhcnNlSW50KGdyaWQuaWQsIDEwKSsoaSpkaXJlY3Rpb24pfWApO1xyXG4gICAgICAgICAgICAgICAgaWYoZ3JpZExpbmUuY2xhc3NMaXN0WzFdID09PSBcImdyZWVuXCIpIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGdyaWRMaW5lLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBncmlkLnN0eWxlLmJvcmRlciA9IFwiMXB4IHNvbGlkIHJlZFwiO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJuYW1lIiwidGhpcyIsInNoaXBzIiwiYm9hcmQiLCJib2FyZFBvc2l0aW9uQXJyYXkiLCJoYXNTaGlwQXJyYXkiLCJib2FyZENyZWF0ZSIsImkiLCJwdXNoIiwicmVjZWl2ZUF0dGFjayIsInBvcyIsImluY2x1ZGVzIiwic3BsaWNlIiwiY2hlY2tpbmdJZkhpdCIsImluZGV4T2YiLCJnYW1lRW5kIiwibGVuZ3RoIiwic2hpcHNQbGFjZW1lbnQiLCJzaGlwc0FyciIsInNob3J0ZWRTaGlwc0FyciIsInNvcnQiLCJhIiwiYiIsImJvcmRlckhvcml6b250YWwiLCJib3JkZXJWZXJ0aWNhbCIsImV2ZXJ5IiwiZWxlbSIsIlNoaXBzIiwicG9zaXRpb24iLCJoaXRzIiwiaGFzU3Vua2VuIiwiaGl0IiwiaXNTdW5rIiwiY29tcHV0ZXIiLCJzdGFydEdhbWUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJtYWtlUm93cyIsImRpdiIsInJvd3MiLCJjb2xzIiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsImMiLCJjZWxsIiwiY3JlYXRlRWxlbWVudCIsImFwcGVuZENoaWxkIiwiY2xhc3NMaXN0IiwiYWRkIiwiaWQiLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iLCJnZXRSYW5kb21MZWdhbFBvc2l0aW9uIiwiaiIsInBlcnNvbiIsInJhbmRvbU51bWJlciIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIm5ld0FycmF5IiwiYWRkaW5nQXJyYXkiLCJhZGRpbmdEaWdpdCIsInJhbmRvbWlzZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJncmlkSXRlbVBsYXllciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZ3JpZCIsImJhY2tncm91bmRDb2xvciIsInBsYXllclNoaXAiLCJwYXJzZUludCIsInBsYXllclNoaXBzIiwicG9pbnRlckV2ZW50cyIsImNvbXBTaGlwIiwiY29tcHV0ZXJTaGlwcyIsImRpc2FibGVkIiwicmVtb3ZlIiwiY2hlY2tHYW1lRW5kIiwiY29uc29sZSIsImxvZyIsInNob3RzQXJyYXkiLCJzaG90c0FycmF5Q29tcCIsIml0ZW0iLCJwYXJzZUZsb2F0Iiwic2hpcEFycmF5Iiwic2V0VGltZW91dCIsImdldEVsZW1lbnRCeUlkIiwiY29tcHV0ZXJQbGF5IiwiaGl0Qm9hcmQiLCJyb3RhdGUiLCJkaXJlY3Rpb24iLCJjb3VudCIsIm5ld0FycmF5RWxlbWVudCIsImJvcmRlciIsImNsaWNrIiwiZ3JpZExpbmUiLCJzb21lRnVuY3Rpb24iXSwic291cmNlUm9vdCI6IiJ9